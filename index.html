<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spiritual Gifts Assessment</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-indigo-50 via-white to-green-50 min-h-screen p-4">

    <div class="max-w-4xl mx-auto bg-white rounded-3xl shadow-2xl overflow-hidden mt-8">
        <div class="bg-gradient-to-r from-indigo-600 to-purple-600 p-8 text-center text-white">
            <h1 class="text-4xl md:text-5xl font-extrabold">Spiritual Gifts Assessment</h1>
            <p class="mt-4 text-indigo-100" id="user-id-display">Loading...</p>
        </div>

        <div class="p-8 space-y-12">
            <div id="assessment-view">
                <div id="question-area" class="bg-indigo-50 rounded-2xl p-10 text-center border-2 border-indigo-200">
                    <h3 class="text-3xl font-bold text-indigo-800">Loading your assessment...</h3>
                </div>

                <form id="score-form" class="mt-10 flex flex-col md:flex-row gap-6 items-center justify-center">
                    <input type="number" id="score-input" min="0" max="5" 
                           class="w-full md:w-48 p-8 text-6xl font-bold text-center rounded-2xl border-4 border-indigo-300 focus:border-indigo-600 outline-none"
                           oninput="this.value = Math.max(0, Math.min(5, parseInt(this.value)||0))">
                    <button type="submit" 
                            class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold text-2xl py-8 px-12 rounded-2xl shadow-xl transform hover:scale-105 transition">
                        Submit → (Enter)
                    </button>
                </form>

                <div class="mt-10">
                    <p id="progress-text" class="text-right text-gray-600 font-medium text-lg">Progress: 0/200</p>
                    <div class="w-full bg-gray-200 rounded-full h-8 mt-2 overflow-hidden">
                        <div id="progress-bar" class="bg-gradient-to-r from-indigo-500 to-purple-500 h-full transition-all duration-500"></div>
                    </div>
                </div>
            </div>

            <div id="results-view" class="hidden space-y-10">
                <h2 class="text-5xl font-extrabold text-center text-green-600">Assessment Complete!</h2>
                <div id="top-gift-display" class="bg-gradient-to-br from-green-50 to-emerald-50 p-10 rounded-3xl border-4 border-green-400"></div>
                <div class="bg-white p-8 rounded-3xl shadow-xl">
                    <h3 class="text-3xl font-bold mb-6 text-center">Your Top 4 Gifts</h3>
                    <div id="top-four-list" class="space-y-4"></div>
                </div>
                <button onclick="window.app.resetAssessment()" 
                        class="w-full bg-red-600 hover:bg-red-700 text-white font-bold text-2xl py-6 rounded-2xl shadow-xl transition transform hover:scale-105">
                    Start New Assessment
                </button>
            </div>

            <div id="status-message" class="fixed bottom-6 left-1/2 -translate-x-1/2 max-w-lg w-full p-4 rounded-lg text-center font-medium hidden"></div>
        </div>
    </div>

    <!-- Optional Firebase config (won't crash if missing) -->
    <script src="./config.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const CATEGORIES = ["Apostleship","Prophecy","Evangelism","Shepherding","Teaching","Serving","Exhortation","Giving","Giving Aid","Compassion","Healing","Working Miracles","Tongues","Interpretation of Tongues","Wisdom","Knowledge","Faith","Discernment","Helps","Administration"];
        const QUESTION_COUNT = 200;

        // FULLY RESTORED — every gift has correct % + character + verses again
        const GIFT_DETAILS = {
            "Apostleship": { description: "You have a special ability to develop new ministries, churches, or missions in areas where the Gospel has not yet been established. You are a pioneer and an innovator.", prevalence: "1%", bibleCharacter: "Paul", bibleVerse: "2 Corinthians 11:28: 'Besides everything else, I face daily the pressure of my concern for all the churches.'", bibleVerse2: "Ephesians 4:11: 'So Christ himself gave the apostles, the prophets, the evangelists, the pastors and teachers.'" },
            "Prophecy": { description: "You are able to proclaim God's truth with clarity and apply it powerfully to a present situation, often speaking with great conviction.", prevalence: "3%", bibleCharacter: "Agabus", bibleVerse: "Acts 11:28: 'One of them, named Agabus, stood up and through the Spirit predicted a severe famine...'", bibleVerse2: "1 Corinthians 14:3: 'The one who prophesies speaks to people for their strengthening, encouraging and comfort.'" },
            "Evangelism": { description: "You have a deep desire and effectiveness in sharing the Gospel with non-believers, leading them to faith in Jesus Christ.", prevalence: "12%", bibleCharacter: "Philip", bibleVerse: "Acts 8:5-6: 'Philip went down to a city in Samaria and proclaimed the Messiah there...'", bibleVerse2: "Ephesians 4:11: 'So Christ himself gave... the evangelists...'" },
            "Shepherding": { description: "You have the capacity to care for the spiritual welfare of a group of believers, guiding, protecting, and nurturing them.", prevalence: "10%", bibleCharacter: "Peter", bibleVerse: "1 Peter 5:2: 'Be shepherds of God’s flock that is under your care...'", bibleVerse2: "Ephesians 4:11: '...the pastors and teachers.'" },
            "Teaching": { description: "You are gifted at clearly explaining, systematizing, and applying God's Word so others grow in faith.", prevalence: "15%", bibleCharacter: "Apollos", bibleVerse: "Acts 18:24-28: 'He vigorously refuted his Jewish opponents in public debate, proving from the Scriptures that Jesus was the Messiah.'", bibleVerse2: "Romans 12:7: 'if it is teaching, then teach;'" },
            "Serving": { description: "You find joy and fulfillment in meeting practical needs and alleviating burdens for others, often behind the scenes.", prevalence: "25%", bibleCharacter: "Phoebe", bibleVerse: "Romans 16:1-2: '...she has been a great help to many people, including me.'", bibleVerse2: "1 Peter 4:11: 'If anyone serves, they should do so with the strength God provides...'" },
            "Exhortation": { description: "You have the ability to encourage, motivate, and counsel others toward action and greater spiritual vitality.", prevalence: "18%", bibleCharacter: "Barnabas", bibleVerse: "Acts 4:36: 'Joseph, whom the apostles called Barnabas (which means “son of encouragement”)...'", bibleVerse2: "Romans 12:8: 'if it is to encourage, then give encouragement;'" },
            "Giving": { description: "You possess the ability to contribute material resources to the Lord's work with liberality and cheerfulness.", prevalence: "8%", bibleCharacter: "The Macedonian Churches", bibleVerse: "2 Corinthians 8:2-3: '...their extreme poverty welled up in rich generosity... even beyond their ability.'", bibleVerse2: "Romans 12:8: 'if it is to contribute to the needs of others, give generously;'" },
            "Giving Aid": { description: "Your gift is the capacity to wisely manage and steward resources, projects, or people to achieve God's goals.", prevalence: "10%", bibleCharacter: "Dorcas (Tabitha)", bibleVerse: "Acts 9:36: 'She was always doing good and helping the poor.'", bibleVerse2: "1 Corinthians 12:28: '...gifts of helping...'" },
            "Compassion": { description: "You are able to feel genuine empathy and concern for suffering people and translate that compassion into effective action.", prevalence:
