<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spiritual Gifts Assessment</title>
    
    <!-- 1. Load Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. CRITICAL: Load the custom configuration file. 
         This script MUST run first as it defines the global Firebase variables 
         (window.__app_id, window.__firebase_config, etc.). -->
    <script src="./config.js"></script> 
    
    <!-- 3. Main Application Script (uses the variables loaded in step 2) -->
    <script type="module">
        // --- Firebase Imports ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Assessment Data ---
        const CATEGORIES = [
            "Apostleship", "Prophecy", "Evangelism", "Shepherding", "Teaching",
            "Serving", "Exhortation", "Giving", "Giving Aid", "Compassion",
            "Healing", "Working Miracles", "Tongues", "Interpretation of Tongues",
            "Wisdom", "Knowledge", "Faith", "Discernment", "Helps", "Administration"
        ];
        const QUESTION_COUNT = 200;

        // --- Gift Details (Description, Prevalence, Character, and Verse) ---
        const GIFT_DETAILS = {
            "Apostleship": { 
                description: "You have a special ability to develop new ministries, churches, or missions in areas where the Gospel has not yet been established. You are a pioneer and an innovator.",
                prevalence: "1%",
                bibleCharacter: "Paul",
                bibleVerse: "2 Corinthians 11:28: 'Besides everything else, I face daily the pressure of my concern for all the churches.'",
                bibleVerse2: "Ephesians 4:11: 'So Christ himself gave the apostles, the prophets, the evangelists, the pastors and teachers.'"
            },
            "Prophecy": {
                description: "You are able to proclaim God's truth with clarity and apply it powerfully to a present situation, often speaking with great conviction and calling people to repentance and righteousness.",
                prevalence: "3%",
                bibleCharacter: "Agabus",
                bibleVerse: "Acts 11:28: 'One of them, named Agabus, stood up and through the Spirit predicted that a severe famine would spread over the entire Roman world. (This happened during the reign of Claudius.)'",
                bibleVerse2: "1 Corinthians 14:3: 'But the one who prophesies speaks to people for their strengthening, encouraging and comfort.'"
            },
            "Evangelism": {
                description: "You have a deep desire and effectiveness in sharing the Gospel with non-believers, leading them to faith in Jesus Christ.",
                prevalence: "12%",
                bibleCharacter: "Philip",
                bibleVerse: "Acts 8:5-6: 'Philip went down to a city in Samaria and proclaimed the Messiah there. When the crowds heard Philip and saw the signs he performed, they all paid close attention to what he said.'",
                bibleVerse2: "Ephesians 4:11: 'So Christ himself gave the apostles, the prophets, the evangelists, the pastors and teachers.'"
            },
            "Shepherding": {
                description: "You have the capacity to care for the spiritual welfare of a group of believers, guiding, protecting, and nurturing them toward spiritual maturity. You are a true spiritual guide.",
                prevalence: "10%",
                bibleCharacter: "Peter",
                bibleVerse: "1 Peter 5:2: 'Be shepherds of God’s flock that is under your care, watching over them—not because you must, but because you are willing, as God wants you to be...'",
                bibleVerse2: "Ephesians 4:11: 'So Christ himself gave the apostles, the prophets, the evangelists, the pastors and teachers.'"
            },
            "Teaching": {
                description: "You are gifted at clearly explaining, systematizing, and applying God's Word in a way that helps others learn and grow in their faith.",
                prevalence: "15%",
                bibleCharacter: "Apollos",
                bibleVerse: "Acts 18:24-28: 'He vigorously refuted his Jewish opponents in public debate, proving from the Scriptures that Jesus was the Messiah.'",
                bibleVerse2: "Romans 12:7: 'If it is serving, then serve; if it is teaching, then teach;'"
            },
            "Serving": {
                description: "You find joy and fulfillment in meeting practical needs and alleviating burdens for others, often behind the scenes, with a spirit of humility.",
                prevalence: "25%",
                bibleCharacter: "Phoebe",
                bibleVerse: "Romans 16:1-2: '...she has been a great help to many people, including me.'",
                bibleVerse2: "1 Peter 4:11: 'If anyone serves, they should do so with the strength God provides, so that in all things God may be praised through Jesus Christ.'"
            },
            "Exhortation": {
                description: "You have the ability to encourage, motivate, and counsel others toward action and greater spiritual vitality. You are an uplifter and motivator.",
                prevalence: "18%",
                bibleCharacter: "Barnabas",
                bibleVerse: "Acts 4:36: 'Joseph... whom the apostles called Barnabas (which means “son of encouragement”), sold a field he owned and brought the money and put it at the apostles’ feet.'",
                bibleVerse2: "Romans 12:8: 'if it is to encourage, then give encouragement;'"
            },
            "Giving": {
                description: "You possess the ability to contribute material resources to the Lord's work with liberality and cheerfulness, often exceeding expected levels.",
                prevalence: "8%",
                bibleCharacter: "The Macedonian Churches",
                bibleVerse: "2 Corinthians 8:2-3: '...their overflowing joy and their extreme poverty welled up in rich generosity. For I testify that they gave as much as they were able, and even beyond their ability.'",
                bibleVerse2: "Romans 12:8: 'if it is to contribute to the needs of others, give generously;'"
            },
            "Giving Aid": {
                description: "Your gift is the capacity to wisely manage and steward resources, projects, or people to achieve God's goals. You bring order and efficiency.",
                prevalence: "10%",
                bibleCharacter: "Dorcas (Tabitha)",
                bibleVerse: "Acts 9:36: 'In Joppa there was a disciple named Tabitha... she was always doing good and helping the poor.'",
                bibleVerse2: "1 Corinthians 12:28: 'And God has placed in the church first of all apostles, second prophets, third teachers, then miracles, then gifts of healing, of helping, of guidance, and of different kinds of tongues.'" // Using 'helping' as a close match
            },
            "Compassion": {
                description: "You are able to feel genuine empathy and concern for suffering people and translate that compassion into effective action.",
                prevalence: "22%",
                bibleCharacter: "Jesus (The Good Samaritan)",
                bibleVerse: "Luke 10:33-34: 'But a Samaritan, as he traveled, came where the man was; and when he saw him, he took pity on him. He went to him and bandaged his wounds...'",
                bibleVerse2: "Romans 12:8: 'if it is to show mercy, do it cheerfully.'"
            },
            "Healing": {
                description: "You are used by God to restore health and wholeness, physically or emotionally, often instantaneously, demonstrating God's power.",
                prevalence: "2%",
                bibleCharacter: "Paul",
                bibleVerse: "Acts 14:8-10: 'Paul looked directly at him, saw that he had faith to be made well, and called out, “Stand up on your feet!”'",
                bibleVerse2: "1 Corinthians 12:9: 'to another faith by the same Spirit, to another gifts of healing by that one Spirit,'"
            },
            "Working Miracles": {
                description: "You have the capacity to perform mighty acts of God that alter the normal course of nature, demonstrating the supernatural power of God.",
                prevalence: "1%",
                bibleCharacter: "Elijah",
                bibleVerse: "1 Kings 17:16: 'For the jar of flour was not used up and the jug of oil did not run dry, in keeping with the word of the Lord spoken by Elijah.'",
                bibleVerse2: "1 Corinthians 12:10: 'to another miraculous powers, to another prophecy, to another distinguishing between spirits, to another speaking in different kinds of tongues, and to still another the interpretation of tongues.'"
            },
            "Tongues": {
                description: "You have the ability to speak a language you have never learned, either human or angelic, for prayer, self-edification, or corporate worship.",
                prevalence: "4%",
                bibleCharacter: "The Disciples at Pentecost",
                bibleVerse: "Acts 2:4: 'All of them were filled with the Holy Spirit and began to speak in other tongues as the Spirit enabled them.'",
                bibleVerse2: "1 Corinthians 14:4: 'Anyone who speaks in a tongue edifies themselves, but the one who prophesies edifies the church.'"
            },
            "Interpretation of Tongues": {
                description: "You are able to translate the message of one speaking in tongues so the entire body of Christ can be edified.",
                prevalence: "2%",
                bibleCharacter: "Paul (Instructing the Church)",
                bibleVerse: "1 Corinthians 14:13: 'For this reason the one who speaks in a tongue should pray that they may interpret what they say.'",
                bibleVerse2: "1 Corinthians 14:27: 'If anyone speaks in a tongue, two—or at the most three—should speak, one at a time, and someone must interpret.'"
            },
            "Wisdom": {
                description: "You are granted exceptional insight into how to apply spiritual truth to complex, specific situations and dilemmas.",
                prevalence: "6%",
                bibleCharacter: "Solomon",
                bibleVerse: "1 Kings 3:28: '...they saw that he had wisdom from God to administer justice.'",
                bibleVerse2: "1 Corinthians 12:8: 'To one there is given through the Spirit a message of wisdom, to another a message of knowledge by means of the same Spirit,'"
            },
            "Knowledge": {
                description: "You are given the capacity to discover, analyze, and systematize information and ideas that are critical to the growth of the church.",
                prevalence: "7%",
                bibleCharacter: "Luke",
                bibleVerse: "Luke 1:3-4: '...it seemed good also to me to write an orderly account for you, most excellent Theophilus, so that you may know the certainty of the things you have been taught.'",
                bibleVerse2: "1 Corinthians 12:8: 'To one there is given through the Spirit a message of wisdom, to another a message of knowledge by means of the same Spirit,'"
            },
            "Faith": {
                description: "You possess extraordinary confidence in God's power and promises, enabling you to step out and accomplish great things for Him against all apparent odds.",
                prevalence: "5%",
                bibleCharacter: "Abraham",
                bibleVerse: "Romans 4:20-21: '...was strengthened in his faith and gave glory to God, being fully persuaded that God had power to do what he had promised.'",
                bibleVerse2: "1 Corinthians 12:9: 'to another faith by the same Spirit, to another gifts of healing by that one Spirit,'"
            },
            "Discernment": {
                description: "You have the power to clearly distinguish between truth and error, especially regarding the motives and spirits behind a person or situation.",
                prevalence: "11%",
                bibleCharacter: "Paul",
                bibleVerse: "Acts 16:18: 'Finally, Paul became so annoyed that he turned around and said to the spirit, “In the name of Jesus Christ I command you to come out of her!” At that moment the spirit left her.'",
                bibleVerse2: "1 Corinthians 12:10: '...to another miraculous powers, to another prophecy, to another distinguishing between spirits, to another speaking in different kinds of tongues, and to still another the interpretation of tongues.'"
            },
            "Helps": {
                description: "Your gift is the ability to assist others in their ministry and tasks with efficiency and effectiveness, freeing them up to focus on their primary callings.",
                prevalence: "20%",
                bibleCharacter: "Timothy",
                bibleVerse: "Philippians 2:20-22: 'I have no one else like him, who will show genuine concern for your welfare. ... as a son with a father he has served with me in the work of the gospel.'",
                bibleVerse2: "Romans 16:2: 'I ask you to receive her in the Lord in a way worthy of his people and to give her any help she may need from you, for she has been the benefactor of many people, including me.'"
            },
            "Administration": {
                description: "You are skilled at planning, organizing, and directing groups of people to accomplish specific goals for the ministry or church.",
                prevalence: "13%",
                bibleCharacter: "Nehemiah",
                bibleVerse: "Nehemiah 2:17-18: 'Come, let us rebuild the wall of Jerusalem... I also told them about the gracious hand of my God on me... They replied, “Let us start rebuilding.”'",
                bibleVerse2: "1 Corinthians 12:28: '...then miracles, then gifts of healing, of helping, of guidance, and of different kinds of tongues.' (The Greek word for 'guidance' often refers to governing or administration.)"
            }
        };

        // --- Global State ---
        let db;
        let auth;
        let userId = null;
        let isFirebaseReady = false;
        // The array is sized +1 to use 1-based indexing (Q1 to Q200)
        let currentAnswers = new Array(QUESTION_COUNT + 1).fill(null);
        let currentQuestion = 1;

        // --- DOM Elements ---
        const questionArea = document.getElementById('question-area');
        const scoreForm = document.getElementById('score-form');
        const scoreInput = document.getElementById('score-input');
        const progressText = document.getElementById('progress-text');
        const progressBar = document.getElementById('progress-bar');
        const assessmentView = document.getElementById('assessment-view');
        const resultsView = document.getElementById('results-view');
        const topGiftDisplay = document.getElementById('top-gift-display');
        const topFourList = document.getElementById('top-four-list');
        const statusMessage = document.getElementById('status-message');
        const userIdDisplay = document.getElementById('user-id-display');

        // --- Config Variables (Accessed from window global due to config.js) ---
        // We ensure a fallback if config.js failed to load
        const appId = typeof window.__app_id !== 'undefined' ? window.__app_id : 'default-app-id';
        // We use a safe parse here, assuming the string might be missing or empty
        let firebaseConfig;
        try {
            firebaseConfig = JSON.parse(typeof window.__firebase_config !== 'undefined' ? window.__firebase_config : '{}');
        } catch (e) {
            console.error("Failed to parse Firebase config:", e);
            firebaseConfig = {};
        }
        const initialAuthToken = typeof window.__initial_auth_token !== 'undefined' ? window.__initial_auth_token : null;

        // --- Utility Functions ---
        const showStatus = (message, isError = false) => {
            statusMessage.textContent = message;
            statusMessage.className = `text-center p-3 rounded-lg ${isError ? 'text-red-600 bg-red-100' : 'text-green-600 bg-green-100'}`;
            statusMessage.style.display = 'block';
            setTimeout(() => {
                statusMessage.style.display = 'none';
            }, 3000);
        };

        const saveProgress = async (data) => {
            if (!isFirebaseReady) {
                console.warn("Firebase not ready. Cannot save progress.");
                return;
            }
            // Private user data path: /artifacts/{appId}/users/{userId}/assessment_progress/data
            const docRef = doc(db, "artifacts", appId, "users", userId, "assessment_progress", "data");
            try {
                // Stringify the array for safe storage in Firestore
                const saveData = { answers: JSON.stringify(data), userId: userId, lastUpdated: new Date() };
                await setDoc(docRef, saveData);
                console.log("Progress saved to Firestore.");
            } catch (e) {
                console.error("Error saving document: ", e);
                showStatus("Error saving progress to the cloud.", true);
            }
        };

        const loadProgress = async () => {
            if (!isFirebaseReady) return null;
            const docRef = doc(db, "artifacts", appId, "users", userId, "assessment_progress", "data");
            try {
                const docSnap = await getDoc(docRef);
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    if (data && data.answers) {
                        console.log("Progress loaded from Firestore.");
                        showStatus("Progress loaded from the cloud.", false);
                        // Parse the string back into an array
                        return JSON.parse(data.answers);
                    }
                }
                console.log("No saved progress found in Firestore.");
                return null;
            } catch (e) {
                console.error("Error loading document: ", e);
                return null;
            }
        };

        // Renders the current question and ensures the input is focused and selected.
        const updateUIAndFocus = () => {
            // Check if assessment is complete
            let answeredCount = currentAnswers.filter(a => a !== null).length - 1; // -1 for index 0
            if (answeredCount === QUESTION_COUNT) {
                renderResults();
                return;
            }

            // Find the next unanswered question if currentQuestion points to an answered one
            while (currentQuestion <= QUESTION_COUNT && currentAnswers[currentQuestion] !== null) {
                currentQuestion++;
            }
            
            // If we moved past 200 after the loop, render results
            if (currentQuestion > QUESTION_COUNT) {
                 renderResults();
                 return;
            }
            
            // 1. Update Question Text
            questionArea.innerHTML = `<h3 class="text-2xl font-bold text-indigo-800">Question ${currentQuestion} / ${QUESTION_COUNT}</h3>
                                     <p class="text-lg mt-2 text-gray-600">Score 0 (Not at all) to 5 (Consistently and strongly)</p>`;

            // 2. Reset and Focus Input for rapid entry
            scoreInput.value = currentAnswers[currentQuestion] || 0;
            scoreInput.focus();
            scoreInput.select(); 
            
            // 3. Update Progress Bar
            const progress = (answeredCount / QUESTION_COUNT) * 100;
            progressText.textContent = `Progress: ${answeredCount}/${QUESTION_COUNT} (${progress.toFixed(0)}%)`;
            progressBar.style.width = `${progress}%`;
            
            // 4. Ensure assessment view is visible
            resultsView.classList.add('hidden');
            assessmentView.classList.remove('hidden');
        };

        // --- Event Handlers ---
        scoreForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const score = parseInt(scoreInput.value, 10);

            if (score < 0 || score > 5 || isNaN(score)) {
                showStatus("Error: Score must be between 0 and 5.", true);
                scoreInput.value = currentAnswers[currentQuestion] || 0;
                scoreInput.focus();
                scoreInput.select();
                return;
            }

            // Save the score
            currentAnswers[currentQuestion] = score;
            saveProgress(currentAnswers); // Save immediately

            // Move to the next question (updateUIAndFocus handles skipping answered ones)
            currentQuestion++;
            
            updateUIAndFocus();
        });

        // --- Results Logic ---
        const calculateResults = () => {
            const rowSums = new Array(20).fill(0);

            for (let q = 1; q <= QUESTION_COUNT; q++) {
                const score = currentAnswers[q];
                if (score !== null) {
                    // Formula: (question_number - 1) % number_of_categories
                    const giftIndex = (q - 1) % CATEGORIES.length; 
                    rowSums[giftIndex] += score;
                }
            }

            return CATEGORIES.map((gift, index) => ({
                gift: gift,
                score: rowSums[index]
            })).sort((a, b) => b.score - a.score);
        };
        
        const renderResults = () => {
            const sortedGifts = calculateResults();
            const topGift = sortedGifts[0];
            
            // Get details for the top gift
            const details = GIFT_DETAILS[topGift.gift] || { 
                description: "No description available.", 
                prevalence: "N/A", 
                bibleCharacter: "A faithful servant",
                bibleVerse: "Consult your Bible for examples of this gift in action.",
                bibleVerse2: "Consult your Bible for examples of this gift in action." // Fallback for new verse
            };

            // Show Results View and hide Assessment View
            assessmentView.classList.add('hidden');
            resultsView.classList.remove('hidden');

            // 1. Top Gift Display - UPDATED TO INCLUDE TWO VERSES
            topGiftDisplay.innerHTML = `
                <h4 class="text-xl font-semibold mb-1 text-gray-700">Your Primary Gift</h4>
                <h1 class="text-5xl font-extrabold text-green-700">${topGift.gift}</h1>
                <p class="text-lg mt-2 mb-4">Score: <b>${topGift.score}</b></p>
                
                <!-- Description Block -->
                <div class="bg-green-100 p-4 rounded-xl border border-green-300 shadow-inner mb-6">
                    <p class="text-gray-700 font-medium text-lg">${details.description}</p>
                    <p class="text-sm text-green-800 mt-3 font-semibold">
                        (Approx. ${details.prevalence} of Christians identify with this gift.)
                    </p>
                </div>
                
                <!-- Character & Verse Block - Now displaying two verses -->
                <div class="bg-indigo-50 p-4 rounded-xl border border-indigo-200 shadow-md space-y-4">
                    <p class="text-xl font-bold text-indigo-700 mb-2">Biblical Insight: ${details.bibleCharacter}</p>
                    
                    <div>
                        <p class="font-semibold text-indigo-600">Primary Reference:</p>
                        <p class="mt-1 text-gray-600 italic leading-relaxed">"${details.bibleVerse}"</p>
                    </div>

                    <div>
                        <p class="font-semibold text-indigo-600">Secondary Reference:</p>
                        <p class="mt-1 text-gray-600 italic leading-relaxed">"${details.bibleVerse2}"</p>
                    </div>
                </div>
            `;

            // 2. Top Four List
            topFourList.innerHTML = '';
            sortedGifts.slice(0, 4).forEach((item, index) => {
                const itemDetails = GIFT_DETAILS[item.gift] || { prevalence: "N/A" };
                const rankClass = index === 0 ? 'bg-yellow-100 font-bold border-yellow-400' : 'bg-white border-gray-200';
                
                topFourList.innerHTML += `
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center p-4 rounded-lg shadow-md border-2 ${rankClass}">
                        <div class="flex items-center space-x-3">
                            <span class="text-xl font-extrabold text-indigo-600 w-8">#${index + 1}</span>
                            <span class="text-xl text-gray-800">${item.gift}</span>
                        </div>
                        <div class="mt-2 sm:mt-0 flex items-center space-x-4">
                            <span class="text-sm text-gray-500">Prevalence: ${itemDetails.prevalence}</span>
                            <span class="text-2xl font-bold text-green-700">Score: ${item.score}</span>
                        </div>
                    </div>
                `;
            });
        };

        // --- Public/Window Functions ---
        window.app = window.app || {};

        // Loads data and finds the next question to start or finish
        window.app.loadProgressAndStart = async () => {
            const loadedAnswers = await loadProgress();
            
            if (loadedAnswers && Array.isArray(loadedAnswers) && loadedAnswers.length === QUESTION_COUNT + 1) {
                currentAnswers = loadedAnswers;
                // Find the next unanswered question
                currentQuestion = 1;
                while (currentQuestion <= QUESTION_COUNT && currentAnswers[currentQuestion] !== null) {
                    currentQuestion++;
                }
            } else {
                // Start fresh if no data or invalid data loaded
                currentAnswers = new Array(QUESTION_COUNT + 1).fill(null);
                currentQuestion = 1;
            }

            updateUIAndFocus();
        };

        // Resets all data and restarts
        window.app.resetAssessment = () => {
            // Using a simple window.prompt replacement for confirmation to avoid window.confirm()
            const confirmed = window.prompt("[Confirmation Required] Are you sure you want to clear ALL progress and start a new assessment?\nType 'YES' (all caps) to confirm:") === 'YES';
            
            if (confirmed) {
                currentAnswers = new Array(QUESTION_COUNT + 1).fill(null);
                currentQuestion = 1;
                if (isFirebaseReady) {
                    saveProgress(currentAnswers); // Save empty array to clear Firestore
                }
                showStatus("Assessment reset. Ready to start!", false);
                updateUIAndFocus();
            }
        };

        // --- Firebase Initialization ---
        const initializeFirebase = async () => {
            // CRITICAL CHECK: Ensure we have the basic config object
            if (!firebaseConfig || Object.keys(firebaseConfig).length === 0 || !firebaseConfig.projectId) {
                console.error("Firebase config is missing or invalid. Data persistence is DISABLED.");
                showStatus("Error: Cloud data persistence is disabled (missing Firebase config). App will run locally.", true);
                userIdDisplay.textContent = "User ID: Persistence Disabled";
                // Fallback: Start the app without persistence
                window.app.loadProgressAndStart();
                return;
            }

            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                // Authenticate user
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

                // Wait for auth state to be confirmed
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        isFirebaseReady = true;
                        userIdDisplay.textContent = `User ID: ${userId}`;
                        console.log(`Firebase authenticated. User ID: ${userId}`);
                        
                        // Start assessment only after Firebase is ready
                        window.app.loadProgressAndStart();
                    } else {
                        console.error("User not authenticated.");
                    }
                });

            } catch (error) {
                // This catch block handles network errors or configuration errors during init/auth
                console.error("Error initializing or authenticating Firebase:", error);
                showStatus("Critical Error: Could not initialize Firebase. Check console for details.", true);
                isFirebaseReady = false;
                userIdDisplay.textContent = "User ID: Auth Error";
                // Fallback: Start the app without persistence
                window.app.loadProgressAndStart();
            }
        };
        
        // Start Firebase initialization when the page is fully loaded
        window.onload = initializeFirebase;
    </script>
</head>
<body class="bg-gray-50 font-sans p-4 md:p-8">

    <div id="app" class="max-w-4xl mx-auto bg-white shadow-2xl rounded-xl p-6 md:p-10 space-y-6">
        <h1 class="text-4xl font-extrabold text-center text-indigo-700">Spiritual Gifts Assessment</h1>
        <p class="text-center text-sm text-gray-500 mb-4 font-mono" id="user-id-display">Initializing Firebase...</p>
        <hr class="border-indigo-200">

        <!-- Assessment Section -->
        <div id="assessment-view" class="space-y-6">
            <h2 class="text-2xl font-semibold text-gray-700">Assessment Questions</h2>
            
            <div id="question-area" class="bg-indigo-50 p-6 rounded-xl shadow-inner border border-indigo-200">
                <!-- Question text and scoring instruction rendered here by JS -->
                <h3 class="text-2xl font-bold text-indigo-800">Loading...</h3>
                <p class="text-lg mt-2 text-gray-600">Please wait while we connect to the database.</p>
            </div>
            
            <form id="score-form" class="flex flex-col sm:flex-row items-center justify-between space-y-4 sm:space-y-0 sm:space-x-4 pt-4">
                <input type="number" 
                        id="score-input" 
                        min="0" 
                        max="5" 
                        value="0" 
                        required 
                        title="Enter a score from 0 (not at all) to 5 (consistently and strongly)"
                        class="w-full sm:w-1/3 p-4 border-4 border-gray-300 rounded-xl focus:ring-4 focus:ring-indigo-400 transition duration-150 shadow-lg text-4xl text-center font-extrabold text-indigo-700"
                        placeholder="0-5"
                        oninput="this.value = Math.min(5, Math.max(0, parseInt(this.value) || 0))">
                
                <button type="submit" 
                         class="w-full sm:w-2/3 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 px-8 rounded-xl transition duration-200 shadow-2xl hover:shadow-indigo-400/50 focus:outline-none focus:ring-4 focus:ring-indigo-300 transform hover:scale-[1.01]">
                    Submit Score (Press Enter)
                </button>
            </form>

            <div id="progress-container" class="space-y-2 pt-4">
                <p id="progress-text" class="text-sm text-gray-600 text-right">Progress: 0/200 (0%)</p>
                <div class="w-full bg-gray-200 rounded-full h-3">
                    <div id="progress-bar" class="bg-indigo-600 h-3 rounded-full transition-all duration-300 ease-out" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- Results Section (Initially hidden) -->
        <div id="results-view" class="hidden space-y-8 p-6 bg-green-50 rounded-xl shadow-inner border border-green-300">
            <h2 class="text-4xl font-extrabold text-center text-green-700">Assessment Complete!</h2>
            
            <div id="top-gift-display" class="bg-white p-8 rounded-2xl border-4 border-green-500 shadow-xl text-center">
                <!-- Top gift, score, description, prevalence, character, and two verses will be displayed here -->
            </div>

            <div id="top-four-display" class="bg-white p-6 rounded-xl shadow-md">
                <h3 class="text-2xl font-bold mb-4 text-gray-800 border-b pb-2 border-gray-200">Your Top 4 Gifts</h3>
                <div id="top-four-list" class="space-y-3">
                    <!-- Top 4 list will be displayed here -->
                </div>
            </div>

            <button onclick="window.app.resetAssessment()" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-4 rounded-xl transition duration-200 shadow-lg focus:outline-none focus:ring-4 focus:ring-red-300">
                Start New Assessment (Clear Data)
            </button>
        </div>
        
        <div id="status-message" class="text-center p-3 hidden bg-red-100 rounded-xl font-medium shadow-md"></div>

    </div>
</body>
</html>
