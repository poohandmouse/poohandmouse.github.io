<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spiritual Gifts Assessment</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-indigo-50 via-white to-green-50 min-h-screen p-4">

    <div class="max-w-4xl mx-auto bg-white rounded-3xl shadow-2xl overflow-hidden mt-8">
        <div class="bg-gradient-to-r from-indigo-600 to-purple-600 p-8 text-center text-white">
            <h1 class="text-4xl md:text-5xl font-extrabold">Spiritual Gifts Assessment</h1>
            <p class="mt-4 text-indigo-100" id="user-id-display">Offline mode ‚Ä¢ Local only</p>
        </div>

        <div class="p-8 space-y-12">
            <div id="assessment-view">
                <div id="question-area" class="bg-indigo-50 rounded-2xl p-10 text-center border-2 border-indigo-200">
                    <h3 class="text-3xl font-bold text-indigo-800">Question 1 / 200</h3>
                    <p class="text-lg mt-3 text-gray-600">0 = Not at all ‚Ä¢ 5 = Very Strongly</p>
                </div>

                <form id="score-form" class="mt-10 flex flex-col md:flex-row gap-6 items-center justify-center">
                    <input type="number" id="score-input" min="0" max="5" value="0"
                           class="w-full md:w-48 p-8 text-6xl font-bold text-center rounded-2xl border-4 border-indigo-300 focus:border-indigo-600 outline-none"
                           oninput="this.value = Math.max(0, Math.min(5, parseInt(this.value)||0))">
                    <button type="submit"
                            class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold text-2xl py-8 px-12 rounded-2xl shadow-xl transform hover:scale-105 transition">
                        Submit ‚Üí (Enter)
                    </button>
                </form>

                <div class="mt-10">
                    <p id="progress-text" class="text-right text-gray-600 font-medium text-lg">Progress: 0/200 (0%)</p>
                    <div class="w-full bg-gray-200 rounded-full h-8 mt-2 overflow-hidden">
                        <div id="progress-bar" class="bg-gradient-to-r from-indigo-500 to-purple-500 h-full transition-all duration-500" style="width:0%"></div>
                    </div>
                </div>
            </div>

            <div id="results-view" class="hidden space-y-10">
                <h2 class="text-5xl font-extrabold text-center text-green-600">Assessment Complete!</h2>
                <div id="top-gift-display" class="bg-gradient-to-br from-green-50 to-emerald-50 p-10 rounded-3xl border-4 border-green-400"></div>
                <div class="bg-white p-8 rounded-3xl shadow-xl">
                    <h3 class="text-3xl font-bold mb-6 text-center">Your Top 4 Gifts</h3>
                    <div id="top-four-list" class="space-y-4"></div>
                </div>
                <button onclick="window.app.resetAssessment()"
                        class="w-full bg-red-600 hover:bg-red-700 text-white font-bold text-2xl py-6 rounded-2xl shadow-xl transition transform hover:scale-105">
                    Start New Assessment
                </button>
            </div>

            <div id="status-message" class="fixed bottom-6 left-1/2 -translate-x-1/2 max-w-lg w-full p-4 rounded-lg text-center font-medium hidden"></div>
        </div>
    </div>

    <script src="./config.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const CATEGORIES = ["Apostleship","Prophecy","Evangelism","Shepherding","Teaching","Serving","Exhortation","Giving","Giving Aid","Compassion","Healing","Working Miracles","Tongues","Interpretation of Tongues","Wisdom","Knowledge","Faith","Discernment","Helps","Administration"];
        const QUESTION_COUNT = 200;

        // NEW: Super exciting descriptions + full Bible verses with text!
        const GIFT_DETAILS = {
            "Apostleship": {
                excitement: "You are a fearless pioneer! God has wired you to launch new ministries, plant churches, and take the Gospel where it‚Äôs never been before ‚Äî just like Paul who turned the world upside down!",
                prevalence: "1%",
                character: "Paul",
                verse1: "Acts 13:2-3 (NIV)<br><i>While they were worshiping the Lord and fasting, the Holy Spirit said, ‚ÄúSet apart for me Barnabas and Saul for the work to which I have called them.‚Äù</i>",
                verse2: "Romans 15:20 (NIV)<br><i>It has always been my ambition to preach the gospel where Christ was not known...</i>"
            },
            "Prophecy": {
                excitement: "You carry the very voice of God! When you speak, heaven breaks in ‚Äî people repent, lives change, and truth cuts through darkness like a flaming sword!",
                prevalence: "3%",
                character: "Agabus",
                verse1: "Acts 11:28 (NIV)<br><i>One of them, named Agabus, stood up and through the Spirit predicted that a severe famine would spread over the entire Roman world.</i>",
                verse2: "Acts 21:10-11 (NIV)<br><i>He came over to us... took Paul‚Äôs belt, tied his own hands and feet with it and said, ‚ÄúThe Holy Spirit says, ‚ÄòIn this way the Jewish leaders in Jerusalem will bind the owner of this belt...‚Äô‚Äù</i>"
            },
            "Evangelism": {
                excitement: "You are a soul-winner on fire! Strangers become brothers and sisters in Christ because you can‚Äôt help but share the Good News with unstoppable joy!",
                prevalence: "12%",
                character: "Philip",
                verse1: "Acts 8:35-38 (NIV)<br><i>Then Philip began with that very passage of Scripture and told him the good news about Jesus... ‚ÄúLook, here is water. What can stand in the way of my being baptized?‚Äù</i>",
                verse2: "Acts 8:12 (NIV)<br><i>But when they believed Philip as he proclaimed the good news of the kingdom of God and the name of Jesus Christ, they were baptized, both men and women.</i>"
            },
            "Shepherding": {
                excitement: "You are a true spiritual father/mother! People grow strong and safe under your care ‚Äî you love the flock with the very heart of the Good Shepherd!",
                prevalence: "10%",
                character: "David (and Peter)",
                verse1: "Psalm 23:1-3 (NIV)<br><i>The Lord is my shepherd, I lack nothing... He guides me along the right paths for his name‚Äôs sake.</i>",
                verse2: "John 21:17 (NIV)<br><i>Jesus said to Simon Peter... ‚ÄúFeed my sheep.‚Äù</i>"
            },
            "Teaching": {
                excitement: "You make the Word come alive! Complex truths become crystal clear ‚Äî people walk away transformed and hungry for more of God!",
                prevalence: "15%",
                character: "Apollos",
                verse1: "Acts 18:24-26 (NIV)<br><i>Meanwhile a Jew named Apollos... spoke with great fervor and taught about Jesus accurately...</i>",
                verse2: "Acts 18:28 (NIV)<br><i>For he vigorously refuted his Jewish opponents in public debate, proving from the Scriptures that Jesus was the Messiah.</i>"
            },
            "Serving": {
                excitement: "You are the unsung hero the church can‚Äôt live without! Your joyful service behind the scenes makes every miracle possible!",
                prevalence: "25%",
                character: "Onesiphorus",
                verse1: "2 Timothy 1:16-18 (NIV)<br><i>May the Lord show mercy to the household of Onesiphorus, because he often refreshed me and was not ashamed of my chains.</i>",
                verse2: "Mark 9:41 (NIV)<br><i>Truly I tell you, anyone who gives you a cup of water in my name... will certainly not lose their reward.</i>"
            },
            "Exhortation": {
                excitement: "You breathe courage into weary souls! One word from you and people get back up, dust off, and run harder after Jesus!",
                prevalence: "18%",
                character: "Barnabas",
                verse1: "Acts 4:36 (NIV)<br><i>Joseph, a Levite from Cyprus, whom the apostles called Barnabas (which means ‚Äúson of encouragement‚Äù)...</i>",
                verse2: "Acts 11:23 (NIV)<br><i>When he arrived and saw what the grace of God had done, he was glad and encouraged them all to remain true to the Lord with all their hearts.</i>"
            },
            "Giving": {
                excitement: "Your generosity shakes the kingdom of darkness! You give with wild joy and God multiplies it to change lives forever!",
                prevalence: "8%",
                character: "The Macedonian Churches",
                verse1: "2 Corinthians 8:2-4 (NIV)<br><i>In the midst of a very severe trial, their overflowing joy and their extreme poverty welled up in rich generosity... they urgently pleaded with us for the privilege of sharing in this service...</i>",
                verse2: "2 Corinthians 9:7 (NIV)<br><i>God loves a cheerful giver.</i>"
            },
            "Giving Aid": {
                excitement: "You see needs before anyone else and meet them with excellence! You are the glue that holds ministries together!",
                prevalence: "10%",
                character: "Dorcas (Tabitha)",
                verse1: "Acts 9:36,39 (NIV)<br><i>All the widows stood around him, crying and showing him the robes and clothing that Dorcas had made while she was still with them.</i>",
                verse2: "Romans 16:1-2 (NIV)<br><i>I commend to you our sister Phoebe... she has been the benefactor of many people, including me.</i>"
            },
            "Compassion": {
                excitement: "Your heart breaks with God‚Äôs heart! You run toward the broken and hurting ‚Äî and Jesus heals through your embrace!",
                prevalence: "22%",
                character: "The Good Samaritan",
                verse1: "Luke 10:33-35 (NIV)<br><i>But a Samaritan... took pity on him... bandaged his wounds... took care of him.</i>",
                verse2: "Colossians 3:12 (NIV)<br><i>As God‚Äôs chosen people... clothe yourselves with compassion, kindness, humility, gentleness and patience.</i>"
            },
            "Healing": {
                excitement: "God‚Äôs healing power flows through your hands and prayers! The sick recover, the broken are made whole ‚Äî miracles follow you!",
                prevalence: "2%",
                character: "Peter",
                verse1: "Acts 5:15 (NIV)<br><i>People brought the sick into the streets... that at least Peter‚Äôs shadow might fall on some of them as he passed by.</i>",
                verse2: "Acts 9:40 (NIV)<br><i>Peter sent them all out... knelt down and prayed... ‚ÄúTabitha, get up.‚Äù She opened her eyes...</i>"
            },
            "Working Miracles": {
                excitement: "You walk in raw supernatural power! Nature obeys, demons flee, and heaven invades earth when you pray!",
                prevalence: "1%",
                character: "Moses",
                verse1: "Exodus 14:21-22 (NIV)<br><i>Then Moses stretched out his hand over the sea, and all that night the Lord drove the sea back... and the Israelites went through the sea on dry ground.</i>",
                verse2: "Deuteronomy 34:11-12 (NIV)<br><i>...no one has ever shown the mighty power or performed the awesome deeds that Moses did...</i>"
            },
            "Tongues": {
                excitement: "You speak the mysteries of heaven! Your prayer language charges you up and releases God‚Äôs power in ways no one else can!",
                prevalence: "4%",
                character: "The 120 at Pentecost",
                verse1: "Acts 2:4 (NIV)<br><i>All of them were filled with the Holy Spirit and began to speak in other tongues as the Spirit enabled them.</i>",
                verse2: "1 Corinthians 14:2 (NIV)<br><i>For anyone who speaks in a tongue... speaks mysteries by the Spirit.</i>"
            },
            "Interpretation of Tongues": {
                excitement: "You unlock heaven‚Äôs secrets for the whole church! When you interpret, everyone is built up and God is glorified!",
                prevalence: "2%",
                character: "The Corinthian Church (instructed by Paul)",
                verse1: "1 Corinthians 14:13 (NIV)<br><i>For this reason the one who speaks in a tongue should pray that they may interpret what they say.</i>",
                verse2: "1 Corinthians 14:27-28 (NIV)<br><i>...and someone must interpret.</i>"
            },
            "Wisdom": {
                excitement: "You have divine insight that solves impossible problems! Kings and leaders seek your counsel because heaven speaks through you!",
                prevalence: "6%",
                character: "Solomon",
                verse1: "1 Kings 3:12 (NIV)<br><i>I will give you a wise and discerning heart, so that there will never have been anyone like you, nor will there ever be.</i>",
                verse2: "1 Kings 4:34 (NIV)<br><i>From all nations people came to listen to Solomon‚Äôs wisdom...</i>"
            },
            "Knowledge": {
                excitement: "God downloads supernatural revelation to you! Hidden truths, lost secrets, and deep mysteries are revealed when you seek Him!",
                prevalence: "7%",
                character: "Daniel",
                verse1: "Daniel 2:22-23 (NIV)<br><i>He reveals deep and hidden things; he knows what lies in darkness... I thank and praise you, God of my ancestors: You have given me wisdom and power, you have made known to me what we asked of you...</i>",
                verse2: "Daniel 2:47 (NIV)<br><i>Surely your God is the God of gods... who reveals mysteries.</i>"
            },
            "Faith": {
                excitement: "You have mountain-moving, history-making faith! When you believe, impossible things become reality ‚Äî miracles happen because YOU believe!",
                prevalence: "5%",
                character: "Abraham",
                verse1: "Hebrews 11:8,11 (NIV)<br><i>By faith Abraham... obeyed and went... By faith Abraham, even though he was past age ‚Äî was enabled to become a father because he considered him faithful who had made the promise.</i>",
                verse2: "Romans 4:20-21 (NIV)<br><i>Yet he did not waver through unbelief regarding the promise of God, but was strengthened in his faith and gave glory to God, being fully persuaded that God had power to do what he had promised.</i>"
            },
            "Discernment": {
                excitement: "You see what others can‚Äôt! Spirits, motives, truth vs. deception ‚Äî nothing is hidden from you. You protect the church like a spiritual watchman!",
                prevalence: "11%",
                character: "Paul",
                verse1: "Acts 16:18 (NIV)<br><i>She kept this up for many days. Finally Paul became so annoyed that he turned around and said to the spirit, ‚ÄúIn the name of Jesus Christ I command you to come out of her!‚Äù At that moment the spirit left her.</i>",
                verse2: "1 John 4:1 (NIV)<br><i>Dear friends, do not believe every spirit, but test the spirits to see whether they are from God...</i>"
            },
            "Helps": {
                excitement: "You multiply other people‚Äôs ministries! Leaders flourish because you free them to do what only they can do ‚Äî you are indispensable!",
                prevalence: "20%",
                character: "Timothy",
                verse1: "Philippians 2:20-22 (NIV)<br><i>I have no one else like him, who will show genuine concern for your welfare... Timothy has proved himself, because as a son with his father he has served with me in the work of the gospel.</i>",
                verse2: "Acts 19:22 (NIV)<br><i>He sent two of his helpers, Timothy and Erastus, to Macedonia...</i>"
            },
            "Administration": {
                excitement: "You turn chaos into kingdom order! Vision becomes reality because you organize, plan, and lead with excellence!",
                prevalence: "13%",
                character: "Nehemiah",
                verse1: "Nehemiah 2:17-18 (NIV)<br><i>Then I said to them... ‚ÄúCome, let us rebuild the wall of Jerusalem...‚Äù They replied, ‚ÄúLet us start rebuilding.‚Äù So they began this good work.</i>",
                verse2: "Nehemiah 6:15 (NIV)<br><i>So the wall was completed... in fifty-two days.</i>"
            }
        };

        let db = null, auth = null, userId = null, isFirebaseReady = false;
        let currentAnswers = new Array(QUESTION_COUNT + 1).fill(null);
        let currentQuestion = 1;

        const el = {
            questionArea: document.getElementById('question-area'),
            scoreForm: document.getElementById('score-form'),
            scoreInput: document.getElementById('score-input'),
            progressText: document.getElementById('progress-text'),
            progressBar: document.getElementById('progress-bar'),
            assessmentView: document.getElementById('assessment-view'),
            resultsView: document.getElementById('results-view'),
            topGiftDisplay: document.getElementById('top-gift-display'),
            topFourList: document.getElementById('top-four-list'),
            statusMessage: document.getElementById('status-message'),
            userIdDisplay: document.getElementById('user-id-display')
        };

        const appId = window.__app_id || 'local';
        let firebaseConfig = {};
        if (typeof window.__firebase_config === 'string' && window.__firebase_config.trim() !== '' && window.__firebase_config !== '{}') {
            try { firebaseConfig = JSON.parse(window.__firebase_config); } catch(e) {}
        }

        const showStatus = (msg, error = false) => {
            el.statusMessage.textContent = msg;
            el.statusMessage.className = `p-4 rounded-lg font-medium ${error ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'}`;
            el.statusMessage.style.display = 'block';
            setTimeout(() => el.statusMessage.style.display = 'none', 4000);
        };

        const saveProgress = async (data) => { if (isFirebaseReady && userId) try { await setDoc(doc(db, "artifacts", appId, "users", userId, "assessment_progress", "data"), { answers: JSON.stringify(data) }); } catch(e) {} };
        const loadProgress = async () => { if (!isFirebaseReady || !userId) return null; try { const snap = await getDoc(doc(db, "artifacts", appId, "users", userId, "assessment_progress", "data")); if (snap.exists() && snap.data().answers) return JSON.parse(snap.data().answers); } catch(e) {} return null; };

        const updateUI = () => {
            const answered = currentAnswers.filter(a => a !== null).length - 1;
            if (answered === QUESTION_COUNT) { renderResults(); return; }
            while (currentQuestion <= QUESTION_COUNT && currentAnswers[currentQuestion] !== null) currentQuestion++;
            if (currentQuestion > QUESTION_COUNT) { renderResults(); return; }

            el.questionArea.innerHTML = `<h3 class="text-3xl font-bold text-indigo-800">Question ${currentQuestion} / 200</h3>
                <p class="text-lg mt-3 text-gray-600">0 = Not at all ‚Ä¢ 5 = Very Strongly</p>`;
            el.scoreInput.value = currentAnswers[currentQuestion] || 0;
            el.scoreInput.focus();
            el.scoreInput.select();

            const pct = (answered / 200) * 100;
            el.progressText.textContent = `Progress: ${answered}/200 (${pct.toFixed(0)}%)`;
            el.progressBar.style.width = `${pct}%`;
        };

        el.scoreForm.addEventListener('submit', e => {
            e.preventDefault();
            const score = parseInt(el.scoreInput.value, 10);
            if (isNaN(score) || score < 0 || score > 5) return showStatus("Enter 0‚Äì5", true);
            currentAnswers[currentQuestion] = score;
            saveProgress(currentAnswers);
            currentQuestion++;
            updateUI();
        });

        const calculateResults = () => {
            const sums = new Array(20).fill(0);
            for (let q = 1; q <= 200; q++) if (currentAnswers[q] !== null) sums[(q-1)%20] += currentAnswers[q];
            return CATEGORIES.map((g,i) => ({gift: g, score: sums[i]})).sort((a,b) => b.score - a.score);
        };

        const renderResults = () => {
            const sorted = calculateResults();
            const top = sorted[0];
            const d = GIFT_DETAILS[top.gift];

            el.assessmentView.classList.add('hidden');
            el.resultsView.classList.remove('hidden');

            el.topGiftDisplay.innerHTML = `
                <div class="text-center mb-10">
                    <h4 class="text-2xl font-bold text-green-800">Your Primary Spiritual Gift Is...</h4>
                    <h1 class="text-7xl font-extrabold text-green-600 my-6">${top.gift}!</h1>
                    <p class="text-4xl font-bold mb-4">Score: ${top.score}/100</p>
                </div>

                <div class="bg-yellow-100 border-4 border-yellow-400 rounded-3xl p-8 mb-10 shadow-2xl">
                    <p class="text-2xl leading-relaxed font-medium text-gray-800">${d.excitement}</p>
                    <p class="text-lg font-bold text-yellow-800 mt-6">Only about ${d.prevalence} of believers have this as their strongest gift ‚Äî you are rare and powerful!</p>
                </div>

                <div class="bg-blue-50 border-2 border-blue-300 rounded-3xl p-8">
                    <h3 class="text-3xl font-bold text-blue-900 mb-6">Biblical Example: ${d.character}</h3>
                    <div class="space-y-6 text-lg italic text-gray-700 leading-relaxed">
                        <div class="bg-white p-6 rounded-xl shadow">${d.verse1}</div>
                        <div class="bg-white p-6 rounded-xl shadow">${d.verse2}</div>
                    </div>
                </div>
            `;

            el.topFourList.innerHTML = sorted.slice(0,4).map((item,i) => {
                const dd = GIFT_DETAILS[item.gift];
                const style = i === 0 ? 'bg-yellow-100 border-yellow-500 shadow-2xl' : 'bg-gray-50 border-gray-300';
                return `<div class="p-6 rounded-2xl border-4 ${style} flex justify-between items-center transform transition hover:scale-105">
                    <div class="flex items-center gap-6">
                        <span class="text-5xl font-bold text-indigo-700">#${i+1}</span>
                        <div>
                            <div class="text-2xl font-bold">${item.gift}</div>
                            <div class="text-sm text-gray-600">~${dd.prevalence} of believers</div>
                        </div>
                    </div>
                    <span class="text-4xl font-extrabold text-green-600">${item.score}</span>
                </div>`;
            }).join('');
        };

        window.app = {
            resetAssessment: () => {
                if (confirm("Delete all progress and start over?")) {
                    currentAnswers = new Array(201).fill(null);
                    currentQuestion = 1;
                    if (isFirebaseReady) saveProgress(currentAnswers);
                    showStatus("Fresh start! üéâ");
                    updateUI();
                }
            }
        };

        const start = async () => {
            if (firebaseConfig.projectId) {
                try {
                    const app = initializeApp(firebaseConfig);
                    db = getFirestore(app);
                    auth = getAuth(app);
                    await signInAnonymously(auth);
                    onAuthStateChanged(auth, user => {
                        if (user) {
                            userId = user.uid; isFirebaseReady = true;
                            el.userIdDisplay.textContent = "Connected ‚Ä¢ Cloud save active";
                            (async () => { const saved = await loadProgress(); if (saved) currentAnswers = saved; updateUI(); })();
                        }
                    });
                    return;
                } catch (e) {}
            }
            el.userIdDisplay.textContent = "Offline mode ‚Ä¢ Local only";
            updateUI();
        };

        start();
    </script>
</body>
</html>
