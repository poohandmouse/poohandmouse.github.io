<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Spiritual Gifts – Honest Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }
    </style>
</head>
<body class="bg-gradient-to-b from-blue-50 to-indigo-100 min-h-screen font-sans">
<div class="max-w-2xl mx-auto p-6">
    <div class="bg-white rounded-3xl shadow-2xl overflow-hidden">
        <div class="bg-gradient-to-r from-indigo-600 to-blue-700 p-8 text-white text-center">
            <h1 class="text-4xl md:text-5xl font-bold mb-2">Discover Your Spiritual Gift</h1>
            <p class="text-indigo-100 text-lg">28 Gifts • 140 Questions + 5 Openness Questions</p>
            <p class="text-sm mt-4 opacity-90" id="user-id-display">Offline mode • Local only</p>
        </div>

        <!-- Assessment -->
        <div id="assessment-view" class="p-8 space-y-10">
            <div class="text-center">
                <div class="text-6xl font-bold text-indigo-600 mb-4" id="current-question-num">1</div>
                <p class="text-gray-600 text-lg">of 145 questions</p>
            </div>
            <div id="question-text" class="bg-blue-50 rounded-2xl p-8 text-xl text-gray-800 leading-relaxed border-2 border-blue-200">
                Loading...
            </div>
            <form id="score-form" class="space-y-8">
                <div class="flex justify-center">
                    <input type="number" id="score-input" min="0" max="5" class="w-56 h-56 text-9xl font-extrabold text-center rounded-3xl border-4 border-indigo-400 focus:border-indigo-600 outline-none shadow-2xl bg-white md:w-72 md:h-72 md:text-[12rem]" placeholder="?" autocomplete="off">
                </div>
                <div class="grid grid-cols-2 gap-4 text-sm text-gray-600">
                    <div class="text-left">0 = Never</div>
                    <div class="text-right">5 = Always</div>
                    <div class="text-left col-span-2 text-center text-gray-500">1 = Rarely • 2 = Sometimes • 3 = Often • 4 = Very Often</div>
                </div>
                <button type="submit" class="w-full bg-gradient-to-r from-indigo-600 to-blue-600 hover:from-indigo-700 hover:to-blue-700 text-white font-bold text-2xl py-6 rounded-2xl shadow-xl transition transform hover:scale-105">
                    Next Question
                </button>
            </form>
            <div class="mt-8">
                <div class="text-right text-gray-600 font-medium mb-2" id="progress-text">0%</div>
                <div class="w-full bg-gray-300 rounded-full h-6 overflow-hidden shadow-inner">
                    <div id="progress-bar" class="bg-gradient-to-r from-indigo-500 to-blue-500 h-full transition-all duration-500" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- Results -->
        <div id="results-view" class="hidden p-8 space-y-12">
            <h2 class="text-5xl font-bold text-center text-green-600 mb-8">Your Spiritual Gifts Profile</h2>
            <div id="top-gift-display" class="bg-gradient-to-br from-green-50 to-emerald-100 rounded-3xl p-10 border-4 border-green-400 shadow-2xl"></div>
            <div class="space-y-8" id="top-gifts-list"></div>
            <div class="bg-purple-50 rounded-3xl p-8 border-4 border-purple-400">
                <h3 class="text-3xl font-bold text-purple-900 mb-6">Manifestation-Gift Openness</h3>
                <div id="manifestation-openness" class="space-y-4 text-lg"></div>
            </div>
            <button onclick="location.reload()" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold text-xl py-6 rounded-2xl shadow-xl">
                Take Assessment Again
            </button>
        </div>
    </div>
</div>

<script src="./config.js"></script>
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    const GIFTS = [
        "Administration","Apostleship","Craftsmanship","Creative Communication","Discernment of Spirits",
        "Encouragement","Evangelism","Faith","Giving","Healing","Helps/Service","Hospitality","Intercession",
        "Interpretation of Tongues","Knowledge","Leadership","Mercy","Miracles","Music/Worship","Pastoral Care",
        "Prophecy","Service","Shepherding","Teaching","Tongues","Wisdom","Witnessing","Writing"
    ];
    const TOTAL_REGULAR = 135;   // 27 gifts × 5 (Service is duplicate of Helps, so 27×5)
    const TOTAL_QUESTIONS = 140; // 135 + 5 openness questions

    // First 135 questions (same as before — motivation/ministry focused)
    const BASE_QUESTIONS = [ /* ← paste the 135 questions from the previous version here — I’ll abbreviate for space */ 
        "I excel at organizing people and resources for ministry","I naturally create systems so things run smoothly",/* …135 total… */
        "God speaks through my writing","My words in print impact lives","I clarify truth through writing","Writing is my main ministry tool","People grow through what I write"
    ].slice(0,135);

    // Final 5 Manifestation-Openness questions
    const OPENNESS_QUESTIONS = [
        "I am open and eager for God to heal people through my prayers, even if it happens rarely",
        "I long to see God do undeniable miracles through me whenever He chooses",
        "I want God to give me timely prophetic words or words of knowledge for others",
        "I desire to discern spirits accurately to protect and build the church",
        "I am open to speaking or praying in tongues and interpreting when the Spirit prompts"
    ];

    const ALL_QUESTIONS = [...BASE_QUESTIONS, ...OPENNESS_QUESTIONS];

    // Shuffling logic (same as before but for 135 + 5)
    const shuffledIndices = [];
    for (let round = 0; round < 5; round++) {
        for (let g = 0; g < 27; g++) shuffledIndices.push(g * 5 + round);
    }
    // Add the 5 openness questions at the very end
    for (let i = 0; i < 5; i++) shuffledIndices.push(135 + i);

    const QUESTIONS = shuffledIndices.map(i => ALL_QUESTIONS[i]);

    let currentAnswers = new Array(TOTAL_QUESTIONS + 1).fill(null);
    let currentQuestion = 1;
    let db = null, auth = null, userId = null, isFirebaseReady = false;

    const el = {
        questionNum: document.getElementById('current-question-num'),
        questionText: document.getElementById('question-text'),
        scoreInput: document.getElementById('score-input'),
        progressText: document.getElementById('progress-text'),
        progressBar: document.getElementById('progress-bar'),
        assessmentView: document.getElementById('assessment-view'),
        resultsView: document.getElementById('results-view'),
        topGiftDisplay: document.getElementById('top-gift-display'),
        topGiftsList: document.getElementById('top-gifts-list'),
        manifestationOpenness: document.getElementById('manifestation-openness'),
        userIdDisplay: document.getElementById('user-id-display')
    };

    // …(same Firebase & UI code as before — unchanged)…

    const calculateResults = () => {
        const scores = GIFTS.map(() => 0);
        // Score first 135 questions (27 real gifts × 5)
        for (let i = 0; i < 135; i++) {
            const answer = currentAnswers[i + 1];
            if (answer !== null) {
                const giftIndex = Math.floor(i / 5);
                if (giftIndex < 27) scores[giftIndex] += answer;
            }
        }
        const regular = GIFTS.slice(0,27).map((g,i)=>({gift:g, score:scores[i]}))
            .sort((a,b)=>b.score-a.score);

        // Manifestation openness scores (last 5 answers)
        const openness = currentAnswers.slice(136,141).map((a,i)=>({
            area: ["Healing","Miracles","Prophecy/Knowledge","Discernment","Tongues/Interpretation"][i],
            score: a || 0
        }));

        return { regular, openness };
    };

    const renderResults = () => {
        const { regular, openness } = calculateResults();
        el.assessmentView.classList.add('hidden');
        el.resultsView.classList.remove('hidden');

        const top = regular[0];
        el.topGiftDisplay.innerHTML = `
            <div class="text-center">
                <h2 class="text-6xl font-bold text-green-600 mb-4">${top.gift}</h2>
                <p class="text-3xl font-bold mb-6">Your Dominant Spiritual Gift</p>
                <p class="text-3xl text-gray-800">Score: ${top.score} / 25</p>
            </div>`;

        el.topGiftsList.innerHTML = regular.slice(0,8).map((g,i)=>`
            <div class="bg-white rounded-2xl p-6 shadow-lg border-l-8 ${i===0?'border-yellow-500':'border-indigo-300'}">
                <div class="flex justify-between items-center">
                    <div class="text-5xl font-bold text-indigo-700">#${i+1}</div>
                    <div class="text-right">
                        <div class="text-2xl font-bold">${g.gift}</div>
                        <div class="text-lg text-gray-600">${g.score}/25</div>
                    </div>
                </div>
            </div>
        `).join('');

        el.manifestationOpenness.innerHTML = openness.map(o=>`
            <div class="flex justify-between items-center bg-white rounded-xl p-5 shadow">
                <div class="font-semibold text-lg">${o.area}</div>
                <div class="text-3xl font-bold text-purple-700">${o.score}/5</div>
            </div>
        `).join('');
    };

    // …(rest of the code — updateUI, submit handler, Firebase, start() — exactly the same as previous version)…

    const start = async () => {
        /* same Firebase code as before */
        el.userIdDisplay.textContent = "Offline mode • Local only";
        updateUI();
    };
    start();
</script>
</body>
</html>
