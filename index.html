<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Discover Your Spiritual Gift</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }
    </style>
</head>
<body class="bg-gradient-to-b from-blue-50 to-indigo-100 min-h-screen font-sans">

<div class="max-w-2xl mx-auto p-6">
    <div class="bg-white rounded-3xl shadow-2xl overflow-hidden">
        <div class="bg-gradient-to-r from-indigo-600 to-blue-700 p-8 text-white text-center">
            <h1 class="text-4xl md:text-5xl font-bold mb-2">Discover Your Spiritual Gift</h1>
            <p class="text-indigo-100 text-lg">God has uniquely gifted you to build His church</p>
            <p class="text-sm mt-4 opacity-90" id="user-id-display">Loading...</p>
        </div>

        <!-- Assessment -->
        <div id="assessment-view" class="p-8 space-y-10">
            <div class="text-center">
                <div class="text-6xl font-bold text-indigo-600 mb-4" id="current-question-num">1</div>
                <p class="text-gray-600 text-lg">of 110 questions</p>
            </div>

            <div id="question-text" class="bg-blue-50 rounded-2xl p-8 text-xl text-gray-800 leading-relaxed border-2 border-blue-200">
                Loading your first question...
            </div>

            <form id="score-form" class="space-y-8">
                <div class="flex justify-center">
                    <input type="number" id="score-input" min="0" max="5" value=""
                           class="w-56 h-56 text-9xl font-extrabold text-center rounded-3xl border-4 border-indigo-400 focus:border-indigo-600 outline-none shadow-2xl bg-white md:w-72 md:h-72 md:text-[12rem]"
                           placeholder="?" autocomplete="off">
                </div>

                <div class="grid grid-cols-2 gap-4 text-sm text-gray-600">
                    <div class="text-left">0 = Never</div>
                    <div class="text-right">5 = Always</div>
                    <div class="text-left col-span-2 text-center text-gray-500">1 = Rarely • 2 = Sometimes • 3 = Often • 4 = Very Often</div>
                </div>

                <button type="submit" class="w-full bg-gradient-to-r from-indigo-600 to-blue-600 hover:from-indigo-700 hover:to-blue-700 text-white font-bold text-2xl py-6 rounded-2xl shadow-xl transition transform hover:scale-105">
                    Next Question →
                </button>
            </form>

            <div class="mt-8">
                <div class="text-right text-gray-600 font-medium mb-2" id="progress-text">0%</div>
                <div class="w-full bg-gray-300 rounded-full h-6 overflow-hidden shadow-inner">
                    <div id="progress-bar" class="bg-gradient-to-r from-indigo-500 to-blue-500 h-full transition-all duration-500" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- Results -->
        <div id="results-view" class="hidden p-8 space-y-12">
            <div class="text-center">
                <h2 class="text-5xl font-bold text-green-600 mb-4">Your Spiritual Gifts Are Revealed!</h2>
                <p class="text-2xl text-gray-700">Here’s how God wants to use YOU in His church today</p>
            </div>

            <!-- Top Gift + Action Steps -->
            <div id="top-gift-display"></div>

            <!-- Top 3 with Practical Steps -->
            <div class="space-y-10" id="top-three-actions"></div>

            <button onclick="window.app.resetAssessment()" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold text-xl py-6 rounded-2xl shadow-xl transition">
                Take Assessment Again
            </button>

            <p class="text-center text-gray-600 text-sm mt-10">
                Based on Romans 12, 1 Corinthians 12, Ephesians 4, 1 Peter 4 & historical church practice
            </p>
        </div>
    </div>
</div>

<script src="./config.js"></script>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    const GIFTS = ["Prophecy","Serving","Teaching","Exhortation","Giving","Leadership","Mercy","Evangelism","Shepherding","Faith","Worship/Music"];
    const TOTAL_QUESTIONS = 110;

    const BASE_QUESTIONS = [
        // Prophecy (1-10)
        "I am compelled to speak truth even when it's unpopular","People say I have insight into spiritual matters others miss","I often sense when something is from God or not","I feel burdened to warn others about sin","God reveals future events or consequences to me","I speak boldly against injustice","Others have said my words brought conviction","I feel God's grief over sin in the church","I am quick to identify false teaching","I have given warnings that later came true",
        // Serving
        "I love doing practical tasks so others can minister","I notice when things need to be fixed or cleaned","I enjoy helping behind the scenes","I feel joy serving without recognition","I volunteer first for unglamorous jobs","I help relieve burdens for leaders","I prefer action over discussion","People rely on me to get things done","I find fulfillment in making others' lives easier","I serve quietly without needing thanks",
        // Teaching
        "I love explaining Scripture so others understand","I study deeply to teach accurately","People say my teaching helps them grow","I organize truth so it's easy to grasp","I enjoy preparing lessons or studies","I correct wrong understanding gently","I can make complex doctrine clear","Others grow in knowledge through my teaching","I research thoroughly before teaching","I feel responsible to teach truth correctly",
        // Exhortation
        "I motivate others to reach their potential","People come to me for encouragement","I see the best in people and call it out","I help others apply truth to daily life","I comfort the discouraged","I challenge people to grow","My words bring hope in hard times","I help people overcome failure","I believe in second chances","I rejoice when others succeed",
        // Giving
        "I give generously and cheerfully","I look for needs I can meet financially","God provides so I can bless others","I give beyond what is expected","I manage money to maximize giving","I give anonymously when possible","I trust God with my finances","Others are blessed through my generosity","I find joy in meeting needs","I live simply to give more",
        // Leadership
        "I naturally take charge in groups","People follow my direction willingly","I see the big picture and set goals","I organize people to accomplish tasks","I delegate effectively","I make decisions confidently","I motivate teams toward vision","I handle responsibility well","I guide groups through change","People trust my leadership",
        // Mercy
        "My heart breaks for the hurting","I feel deep compassion for the suffering","I comfort those who are grieving","I forgive easily and completely","I visit the sick and lonely","I show kindness to the undeserving","I sense others' emotional pain","I bring comfort in crisis","I show grace to the broken","I weep with those who weep",
        // Evangelism
        "I love sharing my faith with unbelievers","People come to Christ through my witness","I look for opportunities to share the gospel","I explain salvation clearly","Strangers open up to me about spiritual things","I feel burdened for the lost","I lead people to pray to receive Christ","I share my testimony naturally","Unbelievers feel comfortable with me","I rejoice greatly when someone is saved",
        // Shepherding
        "I nurture and protect spiritual growth in others","People trust me with their problems","I disciple believers one-on-one","I watch over the spiritual health of others","I restore those who have fallen","I guide people through spiritual struggles","I invest deeply in a few people","I help others mature in faith","People grow under my care","I have a pastor's heart",
        // Faith
        "I trust God in impossible situations","I pray boldly expecting answers","Others are strengthened by my faith","I step out when God speaks","I see possibilities where others see problems","I believe God for big things","My faith inspires others","I remain unshaken in trials","God has answered remarkable prayers for me","I live by 'nothing is impossible with God'",
        // Worship / Music (101-110) — NEW!
        "I feel closest to God when singing or playing music","Worship leading comes naturally to me","I write songs or poetry to express praise","Music moves me to tears or joy in God's presence","I help others enter God's presence through worship","I sense the Holy Spirit's leading during musical worship","I play an instrument or sing to glorify God","People say worship feels deeper when I'm involved","I love creating new worship expressions","Music is my primary way of connecting with God"
    ];

    // Perfect mixing
    const shuffledIndices = [];
    for (let block = 0; block < 10; block++) {
        for (let gift = 0; gift < 11; gift++) {
            shuffledIndices.push(gift * 10 + block);
        }
    }
    const QUESTIONS = shuffledIndices.map(i => BASE_QUESTIONS[i]);

    const GIFT_PRACTICAL = {
        "Prophecy": {
            excitement: "You carry God’s megaphone! When you speak, heaven breaks in — people repent, nations tremble, and truth pierces darkness!",
            character: "Jeremiah",
            how: "Known as the weeping prophet, Jeremiah boldly warned Judah of coming judgment while calling them to repentance, even when it cost him everything.",
            verse1: "Jeremiah 1:9-10 (NIV)<br><i>Then the Lord reached out his hand and touched my mouth and said to me, “I have put my words in your mouth...”</i>",
            verse2: "Jeremiah 20:9 (NIV)<br><i>His word is in my heart like a fire, a fire shut up in my bones...</i>",
            practical: `
                <strong>Modern Roles:</strong> Preaching that confronts sin • Writing blogs/books on cultural issues • Prayer intercession teams • Speaking at revival events<br><br>
                <strong>Local Action:</strong> Join your church’s prophetic prayer team • Start a Bible study on justice issues • Volunteer with pregnancy centers or anti-trafficking ministries<br><br>
                <strong>Missions Fit:</strong> Voice of the Martyrs, Open Doors, IHOPKC 24/7 prayer
            `
        },
        "Serving": {
            excitement: "You are the backbone of every move of God! Your joyful, behind-the-scenes service makes miracles possible and leaders free to soar!",
            character: "Onesiphorus",
            how: "He searched Rome for Paul in prison, refreshed him, and was not ashamed of his chains.",
            verse1: "2 Timothy 1:16-18 (NIV)<br><i>He often refreshed me and was not ashamed of my chains... he searched hard for me until he found me.</i>",
            verse2: "Galatians 6:2 (NIV)<br><i>Carry each other’s burdens, and in this way you will fulfill the law of Christ.</i>",
            practical: `
                <strong>Modern Roles:</strong> Setup/tear-down team • Greeters • Kitchen ministry • Facilities maintenance • Helping single moms or elderly<br><br>
                <strong>Local Action:</strong> Volunteer at food banks • Visit nursing homes • Help with church work days • Serve in children's ministry cleanup<br><br>
                <strong>Missions Fit:</strong> Samaritan’s Purse disaster relief, Convoy of Hope, local homeless shelters
            `
        },
        "Teaching": {
            excitement: "You illuminate God’s Word like no one else! Dry truth becomes living fire — people leave transformed and equipped to change the world!",
            character: "Ezra",
            how: "Ezra devoted himself to studying, obeying, and teaching God’s Law, leading an entire nation back to faithfulness.",
            verse1: "Ezra 7:10 (NIV)<br><i>For Ezra had devoted himself to the study and observance of the Law of the Lord, and to teaching its decrees and laws in Israel.</i>",
            verse2: "Nehemiah 8:8 (NIV)<br><i>They read from the Book of the Law of God, making it clear and giving the meaning so that the people understood what was being read.</i>",
            practical: `
                <strong>Modern Roles:</strong> Sunday school teacher • Small group leader • Bible college instructor • Youth pastor • Online Bible study host<br><br>
                <strong>Local Action:</strong> Start a neighborhood Bible study • Teach at your church’s midweek service • Mentor new believers one-on-one<br><br>
                <strong>Missions Fit:</strong> Bible League International, Precept Ministries, Walk Thru the Bible
            `
        },
        "Exhortation": {
            excitement: "You ignite courage in broken hearts! One word from you and people rise up, shake off fear, and run harder after Jesus!",
            character: "Barnabas",
            how: "He sold his land to support the church, vouched for the converted Saul when everyone feared him, and restored John Mark after failure.",
            verse1: "Acts 11:23-24 (NIV)<br><i>When he arrived and saw what the grace of God had done, he was glad and encouraged them all to remain true to the Lord with all their hearts.</i>",
            verse2: "Acts 4:36 (NIV)<br><i>Joseph, a Levite from Cyprus, whom the apostles called Barnabas (which means “son of encouragement”)...</i>",
            practical: `
                <strong>Modern Roles:</strong> Life coach • Recovery group leader • Hospital visitation • Encouragement card ministry • Prayer team<br><br>
                <strong>Local Action:</strong> Visit shut-ins • Lead Celebrate Recovery or GriefShare • Mentor teens • Start an encouragement ministry<br><br>
                <strong>Missions Fit:</strong> Teen Challenge, Mercy Ships counseling, Prison Fellowship Angel Tree
            `
        },
        "Giving": {
            excitement: "Your generosity shifts atmospheres and funds revival! You give with wild, hilarious joy and watch God multiply it a hundredfold!",
            character: "The Widow of Zarephath",
            how: "In famine, she gave her very last meal to Elijah — trusting God — and her jar of flour and jug of oil never ran out.",
            verse1: "1 Kings 17:13-16 (NIV)<br><i>She went away and did as Elijah had told her. So there was food every day... the jar of flour was not used up and the jug of oil did not run dry.</i>",
            verse2: "2 Corinthians 9:7 (NIV)<br><i>God loves a cheerful giver.</i>",
            practical: `
                <strong>Modern Roles:</strong> Finance committee • Missions giving coordinator • Benevolence fund leader • Scholarship provider<br><br>
                <strong>Local Action:</strong> Sponsor foster children • Pay for VBS supplies • Support church planters • Give to crisis pregnancy centers<br><br>
                <strong>Missions Fit:</strong> Compassion International, Gospel for Asia, Samaritan’s Purse, Convoy of Hope
            `
        },
        "Leadership": {
            excitement: "You turn vision into reality! Chaos becomes kingdom order because you organize people and resources with excellence!",
            character: "Nehemiah",
            how: "He rebuilt Jerusalem’s walls in 52 days by organizing workers, supplies, and defense against opposition.",
            verse1: "Nehemiah 2:17-18 (NIV)<br><i>“Come, let us rebuild the wall of Jerusalem...” They replied, “Let us start rebuilding.” So they began this good work.</i>",
            verse2: "Nehemiah 6:15 (NIV)<br><i>So the wall was completed... in fifty-two days.</i>",
            practical: `
                <strong>Modern Roles:</strong> Elder/Deacon • Ministry director • Small group coordinator • Event planner • Church council<br><br>
                <strong>Local Action:</strong> Lead a new ministry launch • Organize outreach events • Serve on church board • Mentor emerging leaders<br><br>
                <strong>Missions Fit:</strong> Lead short-term mission trips, plant churches with ARC or Stadia, serve with CMF International
            `
        },
        "Mercy": {
            excitement: "Your heart breaks with Jesus’ heart! You run toward the hurting and bring healing mercy that changes lives forever!",
            character: "The Good Samaritan",
            how: "He crossed racial barriers to rescue a beaten stranger, bandaged his wounds, paid for his care, and followed up — the ultimate picture of active mercy.",
            verse1: "Luke 10:33-35 (NIV)<br><i>But a Samaritan... took pity on him. He went to him and bandaged his wounds... brought him to an inn and took care of him.</i>",
            verse2: "Colossians 3:12 (NIV)<br><i>Clothe yourselves with compassion, kindness, humility, gentleness and patience.</i>",
            practical: `
                <strong>Modern Roles:</strong> Hospital visitation • Nursing home ministry • Grief counseling • Prison ministry • Foster care support<br><br>
                <strong>Local Action:</strong> Visit local prisons (e.g., Kairos Prison Ministry) • Serve at homeless shelters • Adopt-a-grandparent program • Crisis pregnancy center volunteer<br><br>
                <strong>Missions Fit:</strong> Mercy Ships, Prison Fellowship, Salvation Army, local food pantries
            `
        },
        "Evangelism": {
            excitement: "You are a walking revival! Strangers become family in Christ because your passion for the lost is contagious and unstoppable!",
            character: "Philip",
            how: "He preached to crowds in Samaria and explained the gospel one-on-one to the Ethiopian eunuch, leading an entire nation’s first convert.",
            verse1: "Acts 8:35-38 (NIV)<br><i>Then Philip began with that very passage of Scripture and told him the good news about Jesus... Then both Philip and the eunuch went down into the water and Philip baptized him.</i>",
            verse2: "Acts 8:12 (NIV)<br><i>But when they believed Philip as he proclaimed the good news... they were baptized, both men and women.</i>",
            practical: `
                <strong>Modern Roles:</strong> Outreach team leader • Street evangelism • Alpha course host • Missions trip evangelist<br><br>
                <strong>Local Action:</strong> Share gospel at parks, campuses, or events • Host backyard Bible clubs • Serve with local rescue mission<br><br>
                <strong>Missions Fit:</strong> Cru, YWAM, Global Media Outreach, The Timothy Initiative
            `
        },
        "Shepherding": {
            excitement: "You have the heart of the Good Shepherd! People heal, grow, and flourish under your loving, protective care!",
            character: "David",
            how: "As a teenage shepherd, David risked his life fighting lions and bears to protect his flock — the same fierce love he later showed as king.",
            verse1: "1 Samuel 17:34-35 (NIV)<br><i>“Your servant has been keeping his father’s sheep. When a lion or a bear came and carried off a sheep from the flock, I went after it, struck it and rescued the sheep from its mouth.”</i>",
            verse2: "Psalm 78:70-72 (NIV)<br><i>He chose David his servant... to be the shepherd of his people Jacob... And David shepherded them with integrity of heart; with skillful hands he led them.</i>",
            practical: `
                <strong>Modern Roles:</strong> Small group pastor • Discipleship mentor • Youth pastor • Recovery group leader • Counseling ministry<br><br>
                <strong>Local Action:</strong> Mentor 3-5 people intentionally • Lead a home group • Visit shut-ins weekly • Start a men's/women's discipleship group<br><br>
                <strong>Missions Fit:</strong> Discipleship-focused trips with Experiencing God or Navigators
            `
        },
        "Faith": {
            excitement: "You move mountains and birth the impossible! When everyone else sees giants, you see God — and miracles follow your unshakable trust!",
            character: "Rahab",
            how: "A Canaanite prostitute believed Israel’s God was the true God, hid the spies at risk of her life, and was spared when Jericho fell — she even joined Jesus’ lineage!",
            verse1: "Joshua 2:11 (NIV)<br><i>When we heard of it, our hearts melted in fear... for the Lord your God is God in heaven above and on the earth below.</i>",
            verse2: "Hebrews 11:31 (NIV)<br><i>By faith the prostitute Rahab, because she welcomed the spies, was not killed with those who were disobedient.</i>",
            practical: `
                <strong>Modern Roles:</strong> Prayer team leader • Intercessory prayer warrior • Healing ministry • Faith-based counseling<br><br>
                <strong>Local Action:</strong> Start a 24/7 prayer chain • Lead prayer walks in your city • Pray over the sick at church • Host prayer nights<br><br>
                <strong>Missions Fit:</strong> IHOPKC, YWAM prayer focus, Global Day of Prayer movements
            `
        },
        "Worship/Music": {
            excitement: "You lead God’s people into His presence! Your voice and instrument open heaven and usher in breakthrough worship!",
            character: "David & the Levites",
            how: "David appointed musicians to minister before the Ark 24/7, and the Levites led Israel in worship with instruments and song.",
            verse1: "1 Chronicles 16:4-6 (NIV)<br><i>He appointed some of the Levites to minister before the ark of the Lord, to extol, thank, and praise the Lord... with lyres, harps and cymbals.</i>",
            verse2: "Ephesians 5:19 (NIV)<br><i>Speaking to one another with psalms, hymns, and songs from the Spirit. Sing and make music from your heart to the Lord.</i>",
            practical: `
                <strong>Modern Roles:</strong> Worship leader • Band member • Choir director • Songwriter • Sound/tech team<br><br>
                <strong>Local Action:</strong> Join or start your church worship team • Write songs for your congregation • Lead worship at youth group or nursing homes<br><br>
                <strong>Missions Fit:</strong> Worship-focused ministries like Jesus Culture, Bethel Music, International House of Prayer
            `
        }
    };

    // ... (same variables, updateUI, event listener, calculateResults, etc. from previous version)

    const renderResults = () => {
        const results = calculateResults();
        const top3 = results.slice(0, 3);

        el.assessmentView.classList.add('hidden');
        el.resultsView.classList.remove('hidden');

        const top = top3[0];
        const d = GIFT_PRACTICAL[top.gift];

        el.topGiftDisplay.innerHTML = `
            <div class="text-center mb-12">
                <h2 class="text-6xl font-bold text-green-600 mb-4">${top.gift}</h2>
                <p class="text-3xl font-bold text-gray-800 mb-6">Your Dominant Spiritual Gift</p>
                <p class="text-2xl leading-relaxed text-gray-700 mb-8">${d.excitement}</p>
            </div>

            <div class="bg-gradient-to-br from-yellow-50 to-amber-100 rounded-3xl p-10 border-4 border-yellow-400 shadow-2xl">
                <h3 class="text-3xl font-bold text-amber-900 mb-6">How God Wants to Use You TODAY</h3>
                <div class="text-lg text-gray-800 leading-relaxed space-y-4">${d.practical}</div>
            </div>

            <div class="bg-blue-50 rounded-3xl p-8 border-2 border-blue-300 mt-10">
                <h3 class="text-2xl font-bold text-blue-900 mb-6">Biblical Example: ${d.character}</h3>
                <p class="text-lg italic text-gray-700 mb-6">${d.how}</p>
                <div class="space-y-4 text-base italic text-gray-700">
                    <div class="bg-white p-6 rounded-xl shadow">${d.verse1}</div>
                    <div class="bg-white p-6 rounded-xl shadow">${d.verse2}</div>
                </div>
            </div>
        `;

        el.topThreeActions.innerHTML = top3.slice(1).map((item, i) => {
            const dd = GIFT_PRACTICAL[item.gift];
            return `
                <div class="bg-gradient-to-r from-purple-50 to-indigo-50 rounded-3xl p-8 border-4 border-purple-300 shadow-xl">
                    <h3 class="text-3xl font-bold text-purple-800 mb-4">#${i+2} — ${item.gift}</h3>
                    <p class="text-xl leading-relaxed text-gray-700 mb-6">${dd.excitement}</p>
                    <div class="text-lg leading-relaxed space-y-3">${dd.practical}</div>
                </div>
            `;
        }).join('');
    };

    // ... (rest of the script unchanged — start(), updateUI(), etc.)

    start();
</script>
</body>
</html>
