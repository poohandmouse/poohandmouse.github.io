<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Discover Your Spiritual Gift</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }
    </style>
</head>
<body class="bg-gradient-to-b from-blue-50 to-indigo-100 min-h-screen font-sans">

<div class="max-w-2xl mx-auto p-6">
    <div class="bg-white rounded-3xl shadow-2xl overflow-hidden">
        <div class="bg-gradient-to-r from-indigo-600 to-blue-700 p-8 text-white text-center">
            <h1 class="text-4xl md:text-5xl font-bold mb-2">Discover Your Spiritual Gift</h1>
            <p class="text-indigo-100 text-lg">God has uniquely gifted you to build His church</p>
            <p class="text-sm mt-4 opacity-90" id="user-id-display">Loading...</p>
        </div>

        <!-- Assessment -->
        <div id="assessment-view" class="p-8 space-y-10">
            <div class="text-center">
                <div class="text-6xl font-bold text-indigo-600 mb-4" id="current-question-num">1</div>
                <p class="text-gray-600 text-lg">of 100 questions</p>
            </div>

            <div id="question-text" class="bg-blue-50 rounded-2xl p-8 text-xl text-gray-800 leading-relaxed border-2 border-blue-200">
                Loading your first question...
            </div>

            <form id="score-form" class="space-y-8">
                <div class="flex justify-center">
                    <input type="number" id="score-input" min="0" max="5" value="3"
                           class="w-56 h-56 text-9xl font-extrabold text-center rounded-3xl border-4 border-indigo-400 focus:border-indigo-600 outline-none shadow-2xl bg-white md:w-72 md:h-72 md:text-[12rem]"
                           oninput="this.value = Math.max(0, Math.min(5, parseInt(this.value)||0))">
                </div>

                <div class="grid grid-cols-2 gap-4 text-sm text-gray-600">
                    <div class="text-left">0 = Never</div>
                    <div class="text-right">5 = Always</div>
                    <div class="text-left col-span-2 text-center text-gray-500">1 = Rarely • 2 = Sometimes • 3 = Often • 4 = Very Often</div>
                </div>

                <button type="submit" class="w-full bg-gradient-to-r from-indigo-600 to-blue-600 hover:from-indigo-700 hover:to-blue-700 text-white font-bold text-2xl py-6 rounded-2xl shadow-xl transition transform hover:scale-105">
                    Next Question →
                </button>
            </form>

            <div class="mt-8">
                <div class="text-right text-gray-600 font-medium mb-2" id="progress-text">0%</div>
                <div class="w-full bg-gray-300 rounded-full h-6 overflow-hidden shadow-inner">
                    <div id="progress-bar" class="bg-gradient-to-r from-indigo-500 to-blue-500 h-full transition-all duration-500" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- Results - FULLY RESTORED WITH ALL VERBIAGE & VERSES -->
        <div id="results-view" class="hidden p-8 space-y-10">
            <div class="text-center">
                <h2 class="text-5xl font-bold text-green-600 mb-4">Congratulations!</h2>
                <p class="text-2xl text-gray-700">Here are your top spiritual gifts</p>
            </div>

            <div id="top-gift-display" class="bg-gradient-to-br from-green-50 to-emerald-100 rounded-3xl p-10 border-4 border-green-400 shadow-2xl"></div>

            <div class="space-y-8" id="top-four-list"></div>

            <button onclick="window.app.resetAssessment()" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold text-xl py-6 rounded-2xl shadow-xl transition">
                Take Assessment Again
            </button>

            <p class="text-center text-gray-600 text-sm mt-10">
                Based on Romans 12, 1 Corinthians 12, Ephesians 4 & 1 Peter 4
            </p>
        </div>
    </div>
</div>

<script src="./config.js"></script>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    const GIFTS = ["Prophecy","Serving","Teaching","Exhortation","Giving","Leadership","Mercy","Evangelism","Shepherding","Faith"];
    const TOTAL_QUESTIONS = 100;

    const BASE_QUESTIONS = [
        // Prophecy
        "I am compelled to speak truth even when it's unpopular","People say I have insight into spiritual matters others miss","I often sense when something is from God or not","I feel burdened to warn others about sin","God reveals future events or consequences to me","I speak boldly against injustice","Others have said my words brought conviction","I feel God's grief over sin in the church","I am quick to identify false teaching","I have given warnings that later came true",
        // Serving
        "I love doing practical tasks so others can minister","I notice when things need to be fixed or cleaned","I enjoy helping behind the scenes","I feel joy serving without recognition","I volunteer first for unglamorous jobs","I help relieve burdens for leaders","I prefer action over discussion","People rely on me to get things done","I find fulfillment in making others' lives easier","I serve quietly without needing thanks",
        // Teaching
        "I love explaining Scripture so others understand","I study deeply to teach accurately","People say my teaching helps them grow","I organize truth so it's easy to grasp","I enjoy preparing lessons or studies","I correct wrong understanding gently","I can make complex doctrine clear","Others grow in knowledge through my teaching","I research thoroughly before teaching","I feel responsible to teach truth correctly",
        // Exhortation
        "I motivate others to reach their potential","People come to me for encouragement","I see the best in people and call it out","I help others apply truth to daily life","I comfort the discouraged","I challenge people to grow","My words bring hope in hard times","I help people overcome failure","I believe in second chances","I rejoice when others succeed",
        // Giving
        "I give generously and cheerfully","I look for needs I can meet financially","God provides so I can bless others","I give beyond what is expected","I manage money to maximize giving","I give anonymously when possible","I trust God with my finances","Others are blessed through my generosity","I find joy in meeting needs","I live simply to give more",
        // Leadership
        "I naturally take charge in groups","People follow my direction willingly","I see the big picture and set goals","I organize people to accomplish tasks","I delegate effectively","I make decisions confidently","I motivate teams toward vision","I handle responsibility well","I guide groups through change","People trust my leadership",
        // Mercy
        "My heart breaks for the hurting","I feel deep compassion for the suffering","I comfort those who are grieving","I forgive easily and completely","I visit the sick and lonely","I show kindness to the undeserving","I sense others' emotional pain","I bring comfort in crisis","I show grace to the broken","I weep with those who weep",
        // Evangelism
        "I love sharing my faith with unbelievers","People come to Christ through my witness","I look for opportunities to share the gospel","I explain salvation clearly","Strangers open up to me about spiritual things","I feel burdened for the lost","I lead people to pray to receive Christ","I share my testimony naturally","Unbelievers feel comfortable with me","I rejoice greatly when someone is saved",
        // Shepherding
        "I nurture and protect spiritual growth in others","People trust me with their problems","I disciple believers one-on-one","I watch over the spiritual health of others","I restore those who have fallen","I guide people through spiritual struggles","I invest deeply in a few people","I help others mature in faith","People grow under my care","I have a pastor's heart",
        // Faith
        "I trust God in impossible situations","I pray boldly expecting answers","Others are strengthened by my faith","I step out when God speaks","I see possibilities where others see problems","I believe God for big things","My faith inspires others","I remain unshaken in trials","God has answered remarkable prayers for me","I live by 'nothing is impossible with God'"
    ];

    // Perfect mixing — just like your original
    const shuffledIndices = [];
    for (let block = 0; block < 10; block++) {
        for (let gift = 0; gift < 10; gift++) {
            shuffledIndices.push(gift * 10 + block);
        }
    }
    const QUESTIONS = shuffledIndices.map(i => BASE_QUESTIONS[i]);

    const GIFT_DETAILS = {
        "Prophecy": { excitement: "You carry God’s megaphone! When you speak, heaven breaks in — people repent, nations tremble, and truth pierces darkness!", character: "Jeremiah", how: "Known as the weeping prophet, Jeremiah boldly warned Judah of coming judgment while calling them to repentance, even when it cost him everything.", verse1: "Jeremiah 1:9-10 (NIV)<br><i>Then the Lord reached out his hand and touched my mouth and said to me, “I have put my words in your mouth. See, today I appoint you over nations and kingdoms to uproot and tear down, to destroy and overthrow, to build and to plant.”</i>", verse2: "Jeremiah 20:9 (NIV)<br><i>But if I say, “I will not mention his word or speak anymore in his name,” his word is in my heart like a fire, a fire shut up in my bones. I am weary of holding it in; indeed, I cannot.</i>" },
        "Serving": { excitement: "You are the backbone of every move of God! Your joyful, behind-the-scenes service makes miracles possible and leaders free to soar!", character: "Onesiphorus", how: "He searched hard for Paul in Rome, refreshed him in prison, and was not ashamed of his chains — a perfect picture of faithful, practical service.", verse1: "2 Timothy 1:16-18 (NIV)<br><i>May the Lord show mercy to the household of Onesiphorus, because he often refreshed me and was not ashamed of my chains... he searched hard for me until he found me.</i>", verse2: "Galatians 6:2 (NIV)<br><i>Carry each other’s burdens, and in this way you will fulfill the law of Christ.</i>" },
        "Teaching": { excitement: "You illuminate God’s Word like no one else! Dry truth becomes living fire — people leave transformed and equipped to change the world!", character: "Ezra", how: "Ezra devoted himself to studying, obeying, and teaching God’s Law, leading an entire nation back to scriptural faithfulness after exile.", verse1: "Ezra 7:10 (NIV)<br><i>For Ezra had devoted himself to the study and observance of the Law of the Lord, and to teaching its decrees and laws in Israel.</i>", verse2: "Nehemiah 8:8 (NIV)<br><i>They read from the Book of the Law of God, making it clear and giving the meaning so that the people understood what was being read.</i>" },
        "Exhortation": { excitement: "You ignite courage in broken hearts! One word from you and people rise up, shake off fear, and run harder after Jesus!", character: "Barnabas", how: "He sold his land to support the church, vouched for the converted Saul when everyone feared him, and restored John Mark after failure.", verse1: "Acts 11:23-24 (NIV)<br><i>When he arrived and saw what the grace of God had done, he was glad and encouraged them all to remain true to the Lord with all their hearts. He was a good man, full of the Holy Spirit and faith...</i>", verse2: "Acts 15:37-39 (NIV)<br><i>Barnabas wanted to take John, also called Mark... They had such a sharp disagreement that they parted company. (Later Paul reconciled — Barnabas never gave up on Mark!)</i>" },
        "Giving": { excitement: "Your generosity shifts atmospheres and funds revival! You give with wild, hilarious joy and watch God multiply it a hundredfold!", character: "The Widow of Zarephath", how: "In famine, she gave her very last meal to Elijah — trusting God — and her jar of flour and jug of oil never ran out until the drought ended.", verse1: "1 Kings 17:13-16 (NIV)<br><i>Elijah said to her, “Don’t be afraid... first make a small loaf of bread for me from what you have...” She went away and did as Elijah had told her. So there was food every day... the jar of flour was not used up and the jug of oil did not run dry.</i>", verse2: "2 Corinthians 9:7 (NIV)<br><i>Each of you should give what you have decided in your heart to give, not reluctantly or under compulsion, for God loves a cheerful giver.</i>" },
        "Leadership": { excitement: "You turn vision into reality! Chaos becomes kingdom order because you organize people and resources with excellence!", character: "Jethro’s advice to Moses → Moses implemented it", how: "Moses was burning out judging Israel alone; Jethro taught him to delegate, appoint leaders of thousands, hundreds, fifties, and tens — saving his life and the nation.", verse1: "Exodus 18:21-23 (NIV)<br><i>But select capable men from all the people... have them serve as judges for the people at all times... That will make your load lighter... If you do this and God so commands, you will be able to stand the strain, and all these people will go home satisfied.</i>", verse2: "Exodus 18:25-26 (NIV)<br><i>He chose capable men from all Israel and made them leaders of the people... They served as judges for the people at all times.</i>" },
        "Mercy": { excitement: "Your heart breaks with Jesus’ heart! You run toward the hurting and bring healing mercy that changes lives forever!", character: "The Good Samaritan", how: "He crossed racial and religious barriers to rescue a beaten stranger, bandaged his wounds, paid for his care, and followed up — the ultimate picture of active mercy.", verse1: "Luke 10:33-35 (NIV)<br><i>But a Samaritan... when he saw him, he took pity on him. He went to him and bandaged his wounds, pouring on oil and wine. Then he put the man on his own donkey, brought him to an inn and took care of him... “Look after him,” he said, “and when I return, I will reimburse you...”</i>", verse2: "Colossians 3:12 (NIV)<br><i>Therefore, as God’s chosen people... clothe yourselves with compassion, kindness, humility, gentleness and patience.</i>" },
        "Evangelism": { excitement: "You are a walking revival! Strangers become family in Christ because your passion for the lost is contagious and unstoppable!", character: "Philip", how: "Philip preached to crowds in Samaria and then explained the gospel one-on-one to the Ethiopian eunuch, leading an entire nation’s first convert.", verse1: "Acts 8:35-38 (NIV)<br><i>Then Philip began with that very passage of Scripture and told him the good news about Jesus... Then both Philip and the eunuch went down into the water and Philip baptized him.</i>", verse2: "Acts 8:12 (NIV)<br><i>But when they believed Philip as he proclaimed the good news of the kingdom of God and the name of Jesus Christ, they were baptized, both men and women.</i>" },
        "Shepherding": { excitement: "You have the heart of the Good Shepherd! People heal, grow, and flourish under your loving, protective care — just like David did for Israel and his literal sheep!", character: "David", how: "As a teenage shepherd, David risked his life fighting lions and bears to protect his flock — the same fierce love he later showed as king caring for God’s people.", verse1: "1 Samuel 17:34-35 (NIV)<br><i>But David said... “Your servant has been keeping his father’s sheep. When a lion or a bear came and carried off a sheep from the flock, I went after it, struck it and rescued the sheep from its mouth.”</i>", verse2: "Psalm 78:70-72 (NIV)<br><i>He chose David his servant... to be the shepherd of his people Jacob, of Israel his inheritance. And David shepherded them with integrity of heart; with skillful hands he led them.</i>" },
        "Faith": { excitement: "You move mountains and birth the impossible! When everyone else sees giants, you see God — and miracles follow your unshakable trust!", character: "Rahab", how: "A Canaanite prostitute believed Israel’s God was the true God, hid the spies at risk of her life, and was spared when Jericho fell — she even joined Jesus’ lineage!", verse1: "Joshua 2:11 (NIV)<br><i>When we heard of it, our hearts melted in fear... for the Lord your God is God in heaven above and on the earth below.</i>", verse2: "Hebrews 11:31 (NIV)<br><i>By faith the prostitute Rahab, because she welcomed the spies, was not killed with those who were disobedient.</i>" }
    };

    let currentAnswers = new Array(TOTAL_QUESTIONS + 1).fill(null);
    let currentQuestion = 1;
    let db = null, auth = null, userId = null, isFirebaseReady = false;

    const el = {
        questionNum: document.getElementById('current-question-num'),
        questionText: document.getElementById('question-text'),
        scoreInput: document.getElementById('score-input'),
        progressText: document.getElementById('progress-text'),
        progressBar: document.getElementById('progress-bar'),
        assessmentView: document.getElementById('assessment-view'),
        resultsView: document.getElementById('results-view'),
        topGiftDisplay: document.getElementById('top-gift-display'),
        topFourList: document.getElementById('top-four-list'),
        userIdDisplay: document.getElementById('user-id-display')
    };

    const appId = window.__app_id || 'local';
    let firebaseConfig = {};
    if (typeof window.__firebase_config === 'string' && window.__firebase_config.trim() !== '' && window.__firebase_config !== '{}') {
        try { firebaseConfig = JSON.parse(window.__firebase_config); } catch(e) {}
    }

    const showStatus = (msg, error = false) => {
        const status = document.createElement('div');
        status.textContent = msg;
        status.className = `fixed bottom-6 left-1/2 -translate-x-1/2 p-4 rounded-lg font-medium z-50 ${error ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'}`;
        document.body.appendChild(status);
        setTimeout(() => status.remove(), 4000);
    };

    const saveProgress = async (data) => { if (isFirebaseReady && userId) try { await setDoc(doc(db, "artifacts", appId, "users", userId, "assessment_progress", "data"), { answers: JSON.stringify(data) }); } catch(e) {} };
    const loadProgress = async () => { if (!isFirebaseReady || !userId) return null; try { const snap = await getDoc(doc(db, "artifacts", appId, "users", userId, "assessment_progress", "data")); if (snap.exists() && snap.data().answers) return JSON.parse(snap.data().answers); } catch(e) {} return null; };

    const updateUI = () => {
        const answered = currentAnswers.filter(a => a !== null).length;
        if (answered === TOTAL_QUESTIONS) { renderResults(); return; }

        while (currentQuestion <= TOTAL_QUESTIONS && currentAnswers[currentQuestion] !== null) currentQuestion++;

        el.questionNum.textContent = currentQuestion;
        el.questionText.innerHTML = QUESTIONS[currentQuestion - 1];
        el.scoreInput.value = currentAnswers[currentQuestion] || 3;
        el.scoreInput.focus();

        const pct = Math.round((answered / TOTAL_QUESTIONS) * 100);
        el.progressText.textContent = `${pct}% Complete`;
        el.progressBar.style.width = `${pct}%`;
    };

    document.getElementById('score-form').addEventListener('submit', e => {
        e.preventDefault();
        const score = parseInt(el.scoreInput.value);
        if (score >= 0 && score <= 5) {
            currentAnswers[currentQuestion] = score;
            saveProgress(currentAnswers);
            currentQuestion++;
            updateUI();
        }
    });

    const calculateResults = () => {
        const scores = GIFTS.map(() => 0);
        for (let i = 0; i < TOTAL_QUESTIONS; i++) {
            const answer = currentAnswers[i + 1];
            if (answer !== null) {
                const originalIndex = shuffledIndices[i];
                const giftIndex = Math.floor(originalIndex / 10);
                scores[giftIndex] += answer;
            }
        }
        return GIFTS.map((gift, idx) => ({ gift, score: scores[idx] }))
                   .sort((a, b) => b.score - a.score);
    };

    const renderResults = () => {
        const results = calculateResults();
        const top4 = results.slice(0, 4);

        el.assessmentView.classList.add('hidden');
        el.resultsView.classList.remove('hidden');

        const top = top4[0];
        const d = GIFT_DETAILS[top.gift];

        el.topGiftDisplay.innerHTML = `
            <div class="text-center mb-10">
                <h2 class="text-6xl font-bold text-green-600 mb-4">${top.gift}</h2>
                <p class="text-3xl font-bold text-gray-800 mb-6">Your #1 Spiritual Gift</p>
                <p class="text-2xl text-gray-700 mb-8 leading-relaxed">${d.excitement}</p>
                <div class="bg-yellow-100 rounded-2xl p-6 border-4 border-yellow-400">
                    <p class="text-xl font-bold text-yellow-800">Score: ${top.score} / 50</p>
                </div>
            </div>

            <div class="bg-blue-50 rounded-3xl p-8 border-2 border-blue-300">
                <h3 class="text-2xl md:text-3xl font-bold text-blue-900 mb-6">Biblical Example: ${d.character}</h3>
                <p class="text-lg text-gray-700 mb-6 leading-relaxed italic">${d.how}</p>
                <div class="space-y-6 text-base md:text-lg italic text-gray-700 leading-relaxed">
                    <div class="bg-white p-6 rounded-xl shadow">${d.verse1}</div>
                    <div class="bg-white p-6 rounded-xl shadow">${d.verse2}</div>
                </div>
            </div>
        `;

        el.topFourList.innerHTML = top4.map((item, i) => {
            const dd = GIFT_DETAILS[item.gift];
            const style = i === 0 ? 'bg-yellow-100 border-yellow-500 shadow-2xl' : 'bg-gray-50 border-gray-300';
            return `<div class="p-6 rounded-2xl border-4 ${style} flex justify-between items-center transform transition hover:scale-105">
                <div class="flex items-center gap-4 md:gap-6">
                    <span class="text-4xl md:text-5xl font-bold text-indigo-700">#${i+1}</span>
                    <div>
                        <div class="text-xl md:text-2xl font-bold">${item.gift}</div>
                        <div class="text-sm text-gray-600">Score: ${item.score}/50</div>
                    </div>
                </div>
            </div>`;
        }).join('');
    };

    window.app = { resetAssessment: () => location.reload() };

    const start = async () => {
        if (firebaseConfig.projectId) {
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                await signInAnonymously(auth);
                onAuthStateChanged(auth, async user => {
                    if (user) {
                        userId = user.uid; isFirebaseReady = true;
                        el.userIdDisplay.textContent = "Connected • Cloud save active";
                        const saved = await loadProgress();
                        if (saved) currentAnswers = saved;
                        updateUI();
                    }
                });
                return;
            } catch (e) {}
        }
        el.userIdDisplay.textContent = "Offline mode • Local only";
        updateUI();
    };

    start();
</script>
</body>
</html>
